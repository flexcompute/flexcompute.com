---
author: Tom Chen
custom_css:
- learning-center/fdtd101
- learning-center/menu
- learning-center/home
custom_font: font2
description: This notebook demonstrates how to model a multilevel blazed diffraction
  grating in Tidy3D FDTD.
image:
  alt: Multilevel Blazed Diffraction Grating | Flexcompute
  path: /assets/tidy3d/examples/image/blazed_grating.png
layout: learning-center/example-library
menu_config:
  collapsed: true
  selected: Example Library
metadata:
  category: Metamaterials, Gratings, and Other Periodic Structures
  enable_more_examples: true
  more_examples:
  - name: Gradient metasurface reflector
    path: notebooks/GradientMetasurfaceReflector/
    thumbnail:
      description: Gradient metasurface reflector
      image: /assets/tidy3d/examples/image/gradient_metasurface_reflector_schematic.png
  - name: Graphene metamaterial absorber
    path: notebooks/GrapheneMetamaterial/
    thumbnail:
      description: Graphene metamaterial absorber
      image: /assets/tidy3d/examples/image/graphene_metamaterial_schematic.png
  - name: Tunable chiral metasurface based on phase change material
    path: notebooks/TunableChiralMetasurface/
    thumbnail:
      description: Tunable chiral metasurface based on phase change material
      image: /assets/tidy3d/examples/image/tunable_chiral_metasurface.png
  pagination:
    next:
      name: Biosensor grating simulation
      path: notebooks/BiosensorGrating/
    previous:
      name: Germanium Fano metasurface
      path: notebooks/HighQGe/
  type: example-library
page_title: Multilevel blazed diffraction grating
source_link: https:/docs.flexcompute.com/projects/tidy3d/en/latest/_sources/notebooks/GratingEfficiency.ipynb
tags:
- blazed grating
- diffraction grating
- Tidy3D
- FDTD
title: Multilevel Blazed Diffraction Grating | Flexcompute
---


<html lang="en">
<head><meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="/assets/tidy3d/examples/css/example-notebook.css" rel="stylesheet"/><script>
(function() {
  function addWidgetsRenderer() {
    var mimeElement = document.querySelector('script[type="application/vnd.jupyter.widget-view+json"]');
    var scriptElement = document.createElement('script');
    
    var widgetRendererSrc = 'https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js';
    
    var widgetState;

    // Fallback for older version:
    try {
      widgetState = mimeElement && JSON.parse(mimeElement.innerHTML);

      if (widgetState && (widgetState.version_major < 2 || !widgetState.version_major)) {
        
        var widgetRendererSrc = 'https://unpkg.com/@jupyter-js-widgets@*/dist/embed.js';
        
      }
    } catch(e) {}

    scriptElement.src = widgetRendererSrc;
    document.body.appendChild(scriptElement);
  }

  document.addEventListener('DOMContentLoaded', addWidgetsRenderer);
}());
</script>





<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML-full,Safe"> </script>

<script type="text/x-mathjax-config">
    init_mathjax = function() {
        if (window.MathJax) {
        // MathJax loaded
            MathJax.Hub.Config({
                TeX: {
                    equationNumbers: {
                    autoNumber: "AMS",
                    useLabelIds: true
                    }
                },
                tex2jax: {
                    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                    processEscapes: true,
                    processEnvironments: true
                },
                displayAlign: 'center',
                CommonHTML: {
                    linebreaks: {
                    automatic: true
                    }
                }
            });

            MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        }
    }
    init_mathjax();
    </script>
<script type="module">
  document.addEventListener("DOMContentLoaded", async () => {
    const diagrams = document.querySelectorAll(".jp-Mermaid > pre.mermaid");
    // do not load mermaidjs if not needed
    if (!diagrams.length) {
      return;
    }
    const mermaid = (await import("https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.7.0/mermaid.esm.min.mjs")).default;
    const parser = new DOMParser();

    mermaid.initialize({
      maxTextSize: 100000,
      maxEdges: 100000,
      startOnLoad: false,
      fontFamily: window
        .getComputedStyle(document.body)
        .getPropertyValue("--jp-ui-font-family"),
      theme: document.querySelector("body[data-jp-theme-light='true']")
        ? "default"
        : "dark",
    });

    let _nextMermaidId = 0;

    function makeMermaidImage(svg) {
      const img = document.createElement("img");
      const doc = parser.parseFromString(svg, "image/svg+xml");
      const svgEl = doc.querySelector("svg");
      const { maxWidth } = svgEl?.style || {};
      const firstTitle = doc.querySelector("title");
      const firstDesc = doc.querySelector("desc");

      img.setAttribute("src", `data:image/svg+xml,${encodeURIComponent(svg)}`);
      if (maxWidth) {
        img.width = parseInt(maxWidth);
      }
      if (firstTitle) {
        img.setAttribute("alt", firstTitle.textContent);
      }
      if (firstDesc) {
        const caption = document.createElement("figcaption");
        caption.className = "sr-only";
        caption.textContent = firstDesc.textContent;
        return [img, caption];
      }
      return [img];
    }

    async function makeMermaidError(text) {
      let errorMessage = "";
      try {
        await mermaid.parse(text);
      } catch (err) {
        errorMessage = `${err}`;
      }

      const result = document.createElement("details");
      result.className = 'jp-RenderedMermaid-Details';
      const summary = document.createElement("summary");
      summary.className = 'jp-RenderedMermaid-Summary';
      const pre = document.createElement("pre");
      const code = document.createElement("code");
      code.innerText = text;
      pre.appendChild(code);
      summary.appendChild(pre);
      result.appendChild(summary);

      const warning = document.createElement("pre");
      warning.innerText = errorMessage;
      result.appendChild(warning);
      return [result];
    }

    async function renderOneMarmaid(src) {
      const id = `jp-mermaid-${_nextMermaidId++}`;
      const parent = src.parentNode;
      let raw = src.textContent.trim();
      const el = document.createElement("div");
      el.style.visibility = "hidden";
      document.body.appendChild(el);
      let results = null;
      let output = null;
      try {
        let { svg } = await mermaid.render(id, raw, el);
        svg = cleanMermaidSvg(svg);
        results = makeMermaidImage(svg);
        output = document.createElement("figure");
        results.map(output.appendChild, output);
      } catch (err) {
        parent.classList.add("jp-mod-warning");
        results = await makeMermaidError(raw);
        output = results[0];
      } finally {
        el.remove();
      }
      parent.classList.add("jp-RenderedMermaid");
      parent.appendChild(output);
    }


    /**
     * Post-process to ensure mermaid diagrams contain only valid SVG and XHTML.
     */
    function cleanMermaidSvg(svg) {
      return svg.replace(RE_VOID_ELEMENT, replaceVoidElement);
    }


    /**
     * A regular expression for all void elements, which may include attributes and
     * a slash.
     *
     * @see https://developer.mozilla.org/en-US/docs/Glossary/Void_element
     *
     * Of these, only `<br>` is generated by Mermaid in place of `\n`,
     * but _any_ "malformed" tag will break the SVG rendering entirely.
     */
    const RE_VOID_ELEMENT =
      /<\s*(area|base|br|col|embed|hr|img|input|link|meta|param|source|track|wbr)\s*([^>]*?)\s*>/gi;

    /**
     * Ensure a void element is closed with a slash, preserving any attributes.
     */
    function replaceVoidElement(match, tag, rest) {
      rest = rest.trim();
      if (!rest.endsWith('/')) {
        rest = `${rest} /`;
      }
      return `<${tag} ${rest}>`;
    }

    void Promise.all([...diagrams].map(renderOneMarmaid));
  });
</script>

</head>
<body class="jp-Notebook" data-jp-theme-light="true" data-jp-theme-name="JupyterLab Light">
<main>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=a2d55732-599d-449a-9d20-5df20c5520fd">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>In this example, we compute the grating efficiency of a multilevel diffraction grating whose design is inspired by <code>M. Oliva, T. Harzendorf, D. Michaelis, U. D. Zeitner, and A. Tünnermann, "Multilevel blazed gratings in resonance domain: an alternative to the classical fabrication approach," Opt. Express 19, 14735-14745 (2011)</code>, DOI: <a href="https://doi.org/10.1364/OE.19.014735" target="_blank">10.1364/OE.19.014735</a>.</p>
<p>Tidy3D uses a near field to far field transformation specialized to periodic structures to compute the grating efficiency and its accuracy is verified through a comparison with the semi-analytical rigorous coupled wave analysis (RCWA) approach using the open-source library <a href="https://grcwa.readthedocs.io/en/latest/index.html" target="_blank">grcwa</a>.</p>
<p>Grating structures are ubiquitous in optics and photonics. In another <a href="https://www.flexcompute.com/tidy3d/examples/notebooks/BiosensorGrating/" target="_blank">case study</a>, we investigated the possibility of using a grating structure as a biosensor.</p>
<p>If you are new to the finite-difference time-domain (FDTD) method, we highly recommend going through our <a href="https://www.flexcompute.com/tidy3d/learning-center/" target="_blank">FDTD101</a> tutorials.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=4963c7fb-8d1d-4b15-8794-65a5798d7c5d">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">[1]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># basic python imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Tidy3D import</span>
<span class="kn">import</span> <span class="nn">tidy3d</span> <span class="k">as</span> <span class="nn">td</span>
<span class="kn">from</span> <span class="nn">tidy3d</span> <span class="kn">import</span> <span class="n">web</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=7d4f0faa">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2 id="Normal-incidence">Normal incidence<a class="anchor-link" href="#Normal-incidence">¶</a></h2><p>We will first analyze the grating under normal incidence, as also studied in the paper. In this case, we can use periodic boundary conditions in both tangential directions.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=d12b5401-7572-40ac-ab0a-d563a572381a">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Geometry-setup">Geometry setup<a class="anchor-link" href="#Geometry-setup">¶</a></h3><p>First, the structure and simulation geometry are defined. The structure includes a dielectric substrate with two dielectric patterned layers.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=995e5434-94a2-497a-ab6a-91392c0348b9">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">[2]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Grating parameters (all lengths in um)</span>
<span class="n">index</span> <span class="o">=</span> <span class="mf">1.46847</span>
<span class="n">period</span> <span class="o">=</span> <span class="mf">1.866</span>
<span class="n">width_layer1</span> <span class="o">=</span> <span class="mf">0.519</span>
<span class="n">width_layer2</span> <span class="o">=</span> <span class="mf">1.202</span>
<span class="n">height_layer1</span> <span class="o">=</span> <span class="mf">0.333</span>
<span class="n">height_layer2</span> <span class="o">=</span> <span class="mf">0.281</span>

<span class="c1"># free space central wavelength</span>
<span class="n">wavelength</span> <span class="o">=</span> <span class="mf">0.416</span>

<span class="c1"># Simulation domain geometry</span>
<span class="n">space_above</span> <span class="o">=</span> <span class="n">wavelength</span> <span class="o">*</span> <span class="mi">3</span>
<span class="n">height_substrate</span> <span class="o">=</span> <span class="n">wavelength</span> <span class="o">*</span> <span class="mi">3</span>
<span class="n">space_below</span> <span class="o">=</span> <span class="n">wavelength</span> <span class="o">*</span> <span class="mi">3</span>

<span class="c1"># Define a buffer to make sure objects extend past the simulation boundary</span>
<span class="n">buffer</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="c1"># Simulation domain along x and z</span>
<span class="n">length_x</span> <span class="o">=</span> <span class="n">period</span>
<span class="n">length_z</span> <span class="o">=</span> <span class="n">space_below</span> <span class="o">+</span> <span class="n">height_substrate</span> <span class="o">+</span> <span class="n">height_layer1</span> <span class="o">+</span> <span class="n">height_layer2</span> <span class="o">+</span> <span class="n">space_above</span>

<span class="c1"># Define the medium</span>
<span class="n">grating_medium</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">permittivity</span><span class="o">=</span><span class="n">index</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Create the substrate</span>
<span class="n">substrate</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">Structure</span><span class="p">(</span>
    <span class="n">geometry</span><span class="o">=</span><span class="n">td</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
        <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">length_z</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">height_substrate</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">space_below</span><span class="p">],</span>
        <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="n">td</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">td</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">height_substrate</span><span class="p">],</span>
    <span class="p">),</span>
    <span class="n">medium</span><span class="o">=</span><span class="n">grating_medium</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Level 1 grating</span>
<span class="n">center_L1</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">-</span><span class="n">buffer</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">length_x</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">width_layer1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">width_layer2</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="o">-</span><span class="n">length_z</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">space_below</span> <span class="o">+</span> <span class="n">height_substrate</span> <span class="o">+</span> <span class="n">height_layer2</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">size_L1</span> <span class="o">=</span> <span class="p">[</span><span class="n">width_layer1</span> <span class="o">+</span> <span class="n">width_layer2</span> <span class="o">+</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">td</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">height_layer2</span><span class="p">]</span>
<span class="n">grating_L1</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">Structure</span><span class="p">(</span>
    <span class="n">geometry</span><span class="o">=</span><span class="n">td</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">center_L1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size_L1</span><span class="p">),</span>
    <span class="n">medium</span><span class="o">=</span><span class="n">grating_medium</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Level 2 grating</span>
<span class="n">center_L2</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">-</span><span class="n">buffer</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">length_x</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">width_layer1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="o">-</span><span class="n">length_z</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">space_below</span> <span class="o">+</span> <span class="n">height_substrate</span> <span class="o">+</span> <span class="n">height_layer2</span> <span class="o">+</span> <span class="n">height_layer1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">size_L2</span> <span class="o">=</span> <span class="p">[</span><span class="n">width_layer1</span> <span class="o">+</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">td</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">height_layer1</span><span class="p">]</span>
<span class="n">grating_L2</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">Structure</span><span class="p">(</span>
    <span class="n">geometry</span><span class="o">=</span><span class="n">td</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">center_L2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size_L2</span><span class="p">),</span>
    <span class="n">medium</span><span class="o">=</span><span class="n">grating_medium</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Collect all structures</span>
<span class="n">structures</span> <span class="o">=</span> <span class="p">[</span><span class="n">substrate</span><span class="p">,</span> <span class="n">grating_L1</span><span class="p">,</span> <span class="n">grating_L2</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=b690f441-06c1-42b2-902a-9518762c80c5">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Source-setup">Source setup<a class="anchor-link" href="#Source-setup">¶</a></h3><p>Next, define the source plane wave impinging from above the grating at normal incidence.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=d384ea06-0bf1-440c-9dc4-5a181b02af93">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">[3]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Central frequency in Hz</span>
<span class="n">f0</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">C_0</span> <span class="o">/</span> <span class="n">wavelength</span>

<span class="c1"># Bandwidth</span>
<span class="n">fwidth</span> <span class="o">=</span> <span class="n">f0</span> <span class="o">/</span> <span class="mf">40.0</span>

<span class="c1"># Run time</span>
<span class="n">run_time</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">fwidth</span>

<span class="c1"># Time dependence of source</span>
<span class="n">gaussian</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">GaussianPulse</span><span class="p">(</span><span class="n">freq0</span><span class="o">=</span><span class="n">f0</span><span class="p">,</span> <span class="n">fwidth</span><span class="o">=</span><span class="n">fwidth</span><span class="p">)</span>

<span class="c1"># Source</span>
<span class="n">src_z</span> <span class="o">=</span> <span class="n">length_z</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">space_above</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">angle_theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">10</span>
<span class="n">source</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">PlaneWave</span><span class="p">(</span>
    <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">src_z</span><span class="p">),</span>
    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">td</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">source_time</span><span class="o">=</span><span class="n">gaussian</span><span class="p">,</span>
    <span class="n">direction</span><span class="o">=</span><span class="s2">"-"</span><span class="p">,</span>
    <span class="n">pol_angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">angle_theta</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">angle_phi</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=2d5cd1e2-ee5e-4d22-a2b4-8b18c9f0081b">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Monitor-setup">Monitor setup<a class="anchor-link" href="#Monitor-setup">¶</a></h3><p>Here, we'll set up a field monitor to record and plot the frequency domain fields at a plane in the <code>xz</code> cross-section. We'll also set up two <a href="https://docs.flexcompute.com/projects/tidy3d/en/latest/_autosummary/tidy3d.DiffractionMonitor.html" target="_blank">DiffractionMonitor</a>, one for reflection, and the other for transmission.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=89f43cc2-6d96-4c0a-908e-9bbd62840f34">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">[4]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Fields</span>
<span class="n">monitor_xz</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">FieldMonitor</span><span class="p">(</span>
    <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="n">td</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">td</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">freqs</span><span class="o">=</span><span class="p">[</span><span class="n">f0</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">"field_xz"</span>
<span class="p">)</span>

<span class="c1"># The allowed orders will be computed automatically and returned as part of the results</span>
<span class="n">monitor_r</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">DiffractionMonitor</span><span class="p">(</span>
    <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">length_z</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">wavelength</span><span class="p">],</span>
    <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="n">td</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">td</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">freqs</span><span class="o">=</span><span class="p">[</span><span class="n">f0</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">"reflection"</span><span class="p">,</span>
    <span class="n">normal_dir</span><span class="o">=</span><span class="s2">"+"</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">monitor_t</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">DiffractionMonitor</span><span class="p">(</span>
    <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">length_z</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">wavelength</span><span class="p">],</span>
    <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="n">td</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">td</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">freqs</span><span class="o">=</span><span class="p">[</span><span class="n">f0</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">"transmission"</span><span class="p">,</span>
    <span class="n">normal_dir</span><span class="o">=</span><span class="s2">"-"</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">monitors</span> <span class="o">=</span> <span class="p">[</span><span class="n">monitor_xz</span><span class="p">,</span> <span class="n">monitor_r</span><span class="p">,</span> <span class="n">monitor_t</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">[13:01:10] </span><span style="color: #800000; text-decoration-color: #800000">WARNING: Default value for the field monitor          </span> <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/components/monitor.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">monitor.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/components/monitor.py#261" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">261</span></a>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><span style="color: #008000; text-decoration-color: #008000">'colocate'</span><span style="color: #800000; text-decoration-color: #800000"> setting has changed to </span><span style="color: #008000; text-decoration-color: #008000">'True'</span><span style="color: #800000; text-decoration-color: #800000"> in Tidy3D    </span> <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">              </span>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2.4</span><span style="color: #800000; text-decoration-color: #800000">.</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0</span><span style="color: #800000; text-decoration-color: #800000">. All field components will be colocated to the  </span> <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">              </span>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><span style="color: #800000; text-decoration-color: #800000">grid boundaries. Set to </span><span style="color: #008000; text-decoration-color: #008000">'False'</span><span style="color: #800000; text-decoration-color: #800000"> to get the raw fields </span> <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">              </span>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><span style="color: #800000; text-decoration-color: #800000">on the Yee grid instead.                              </span> <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">              </span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=383d61f0-c458-486d-9573-e52847faa88a">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Set-up-boundary-conditions-and-initialize-simualtion">Set up boundary conditions and initialize simualtion<a class="anchor-link" href="#Set-up-boundary-conditions-and-initialize-simualtion">¶</a></h3><p>For normal incidence, we can use periodic boundary conditions along the <code>x</code> and <code>y</code> directions. More generally, we need to use Bloch boundary conditions as will be illustrated below. We can also use Bloch boundaries with zero Bloch vector for normal incidence, but a simulation with Bloch boundaries uses complex fields and is twice more computationally expensive than a simulation with periodic boundaries, while the results for <code>bloch_vec = 0</code> are equivalent.</p>
<p>Along <code>z</code>, a perfectly matched layer (PML) is applied to mimic an infinite domain. Because the diffraction grating introduces waves propagating at various angles, including steep angles with respect to the PML boundary, we use more layers than the default value to minimize spurious reflections at the PMLs.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=0de6bd71-4044-4999-a2e0-5868fdec613d">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">[5]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Simulation size</span>
<span class="n">length_y</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># grating is translationally invariant along y</span>
<span class="n">sim_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">length_x</span><span class="p">,</span> <span class="n">length_y</span><span class="p">,</span> <span class="n">length_z</span><span class="p">)</span>

<span class="c1"># Resolution</span>
<span class="n">min_steps_per_wvl</span> <span class="o">=</span> <span class="mi">60</span>

<span class="c1"># Boundaries</span>
<span class="n">num_pml_layers</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">boundary_spec</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">BoundarySpec</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">td</span><span class="o">.</span><span class="n">Boundary</span><span class="o">.</span><span class="n">periodic</span><span class="p">(),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">td</span><span class="o">.</span><span class="n">Boundary</span><span class="o">.</span><span class="n">periodic</span><span class="p">(),</span>
    <span class="n">z</span><span class="o">=</span><span class="n">td</span><span class="o">.</span><span class="n">Boundary</span><span class="p">(</span>
        <span class="n">minus</span><span class="o">=</span><span class="n">td</span><span class="o">.</span><span class="n">PML</span><span class="p">(</span><span class="n">num_layers</span><span class="o">=</span><span class="n">num_pml_layers</span><span class="p">),</span> <span class="n">plus</span><span class="o">=</span><span class="n">td</span><span class="o">.</span><span class="n">PML</span><span class="p">(</span><span class="n">num_layers</span><span class="o">=</span><span class="n">num_pml_layers</span><span class="p">)</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="c1"># Simulation</span>
<span class="n">simulation</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span>
    <span class="n">size</span><span class="o">=</span><span class="n">sim_size</span><span class="p">,</span>
    <span class="n">grid_spec</span><span class="o">=</span><span class="n">td</span><span class="o">.</span><span class="n">GridSpec</span><span class="o">.</span><span class="n">auto</span><span class="p">(</span><span class="n">min_steps_per_wvl</span><span class="o">=</span><span class="n">min_steps_per_wvl</span><span class="p">),</span>
    <span class="n">structures</span><span class="o">=</span><span class="n">structures</span><span class="p">,</span>
    <span class="n">sources</span><span class="o">=</span><span class="p">[</span><span class="n">source</span><span class="p">],</span>
    <span class="n">monitors</span><span class="o">=</span><span class="n">monitors</span><span class="p">,</span>
    <span class="n">run_time</span><span class="o">=</span><span class="n">run_time</span><span class="p">,</span>
    <span class="n">boundary_spec</span><span class="o">=</span><span class="n">boundary_spec</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">simulation</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedImage jp-OutputArea-output" tabindex="0">
<img alt="No description has been provided for this image" class="" src="/assets/tidy3d/examples/image/GratingEfficiency/GratingEfficiency_1.png"/>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=005b6b43-4988-4134-91e1-c90da7319aed">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Run-simulation">Run simulation<a class="anchor-link" href="#Run-simulation">¶</a></h3>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=4bebcdbb-af7c-4c54-a22b-083681d1e0cd">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">[6]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">sim_data</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="n">simulation</span><span class="p">,</span>
    <span class="n">task_name</span><span class="o">=</span><span class="s2">"GratingEfficiency"</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">"data/GratingEfficiency.hdf5"</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">[13:01:15] </span>Created task <span style="color: #008000; text-decoration-color: #008000">'GratingEfficiency'</span> with task_id           <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">webapi.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py#188" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">188</span></a>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><span style="color: #008000; text-decoration-color: #008000">'fdve-1eba024a-d762-4392-a758-06acbdbe8114v1'</span>.          <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">             </span>
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>View task using web UI at                               <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">webapi.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py#190" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">190</span></a>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><a href="https://tidy3d.simulation.cloud/workbench?taskId=fdve-1eba024a-d762-4392-a758-06acbdbe8114v1" target="_blank"><span style="color: #008000; text-decoration-color: #008000">'https://tidy3d.simulation.cloud/workbench?taskId=fdve-</span></a> <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">             </span>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><a href="https://tidy3d.simulation.cloud/workbench?taskId=fdve-1eba024a-d762-4392-a758-06acbdbe8114v1" target="_blank"><span style="color: #008000; text-decoration-color: #008000">1eba024a-d762-4392-a758-06acbdbe8114v1'</span></a>.                <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">             </span>
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jupyter-widgets jp-OutputArea-output" id="87d600ab-3ddb-4439-8397-bcdfa21b5528" tabindex="0">
<script type="text/javascript">
var element = document.getElementById('87d600ab-3ddb-4439-8397-bcdfa21b5528');
</script>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "3f6b7777e989462fa74bc33c39e7de0b", "version_major": 2, "version_minor": 0}
</script>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">[13:01:17] </span>status = queued                                         <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">webapi.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py#361" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">361</span></a>
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jupyter-widgets jp-OutputArea-output" id="21bfd43f-0878-404c-bc0a-08e512db9d40" tabindex="0">
<script type="text/javascript">
var element = document.getElementById('21bfd43f-0878-404c-bc0a-08e512db9d40');
</script>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "6d5ddd60636f49ba8314a133ada8dfdd", "version_major": 2, "version_minor": 0}
</script>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">[13:01:26] </span>status = preprocess                                     <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">webapi.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py#355" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">355</span></a>
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">[13:01:30] </span>Maximum FlexCredit cost: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.061</span>. Use                     <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">webapi.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py#341" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">341</span></a>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><span style="color: #008000; text-decoration-color: #008000">'web.real_cost(task_id)'</span> to get the billed FlexCredit   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">             </span>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>cost after a simulation run.                            <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">             </span>
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>starting up solver                                      <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">webapi.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py#377" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">377</span></a>
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>running solver                                          <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">webapi.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py#386" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">386</span></a>
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>To cancel the simulation, use <span style="color: #008000; text-decoration-color: #008000">'web.abort(task_id)'</span> or   <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">webapi.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py#387" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">387</span></a>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><span style="color: #008000; text-decoration-color: #008000">'web.delete(task_id)'</span> or abort/delete the task in the   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">             </span>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>web UI. Terminating the Python script will not stop the <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">             </span>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>job running on the cloud.                               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">             </span>
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jupyter-widgets jp-OutputArea-output" id="847c615d-ccd0-493f-97bf-ba200792f1d4" tabindex="0">
<script type="text/javascript">
var element = document.getElementById('847c615d-ccd0-493f-97bf-ba200792f1d4');
</script>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "6158d86fbdd742a2ad37ec44d40f2fc2", "version_major": 2, "version_minor": 0}
</script>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">[13:01:56] </span>early shutoff detected, exiting.                        <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">webapi.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py#404" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">404</span></a>
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>status = postprocess                                    <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">webapi.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py#419" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">419</span></a>
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jupyter-widgets jp-OutputArea-output" id="e27693f5-1368-431c-8242-d0a93a821e98" tabindex="0">
<script type="text/javascript">
var element = document.getElementById('e27693f5-1368-431c-8242-d0a93a821e98');
</script>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "44f323d6c8804f929974ae35ff2ca7b5", "version_major": 2, "version_minor": 0}
</script>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">[13:02:15] </span>status = success                                        <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">webapi.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py#426" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">426</span></a>
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jupyter-widgets jp-OutputArea-output" id="e93b388e-6548-4200-9cd8-1eb8be636b11" tabindex="0">
<script type="text/javascript">
var element = document.getElementById('e93b388e-6548-4200-9cd8-1eb8be636b11');
</script>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "4d2b82a1c81f415caa28f697b4d528ab", "version_major": 2, "version_minor": 0}
</script>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">[13:02:22] </span>loading SimulationData from data/GratingEfficiency.hdf5 <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">webapi.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py#590" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">590</span></a>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=46b6d225-91ef-4545-917c-e1005acf5be3">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Diffraction-data">Diffraction data<a class="anchor-link" href="#Diffraction-data">¶</a></h3><p>Now we can extract the diffracted power from the output data structures and verfify that the sum across all reflection and transmission orders is close to 1. We can also access the diffraction angles and the complex power amplitudes for each order and polarization.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=de81f913">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">[7]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">data_r</span> <span class="o">=</span> <span class="n">sim_data</span><span class="p">[</span><span class="s2">"reflection"</span><span class="p">]</span>
<span class="n">data_t</span> <span class="o">=</span> <span class="n">sim_data</span><span class="p">[</span><span class="s2">"transmission"</span><span class="p">]</span>
<span class="n">total_power</span> <span class="o">=</span> <span class="n">data_r</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">data_t</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">data_t</span><span class="o">.</span><span class="n">angles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Total power: </span><span class="si">{</span><span class="n">total_power</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Theta (degrees):"</span><span class="p">,</span> <span class="s2">", "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">theta</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Amplitude data: </span><span class="se">\n</span><span class="si">{</span><span class="n">data_t</span><span class="o">.</span><span class="n">amps</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Total power: 0.998056109598111
Theta (degrees): 63.09, 41.98, 26.48, 12.88, 0.00, 12.88, 26.48, 41.98, 63.09
Amplitude data: 
&lt;xarray.DataArray (orders_x: 9, orders_y: 1, f: 1, polarization: 2)&gt;
array([[[[ 5.11645378e-18-1.13903183e-17j,
           3.12479133e-02-6.99603920e-02j]]],


       [[[-1.25585006e-17+7.76528225e-18j,
          -9.82699293e-02+6.07843053e-02j]]],


       [[[ 3.74715479e-17-2.01430106e-17j,
           3.04128892e-01-1.63471267e-01j]]],


       [[[ 3.59066890e-17+5.03400550e-17j,
           2.93110234e-01+4.10932532e-01j]]],


       [[[ 0.00000000e+00+0.00000000e+00j,
          -9.29520310e-03+5.36648283e-01j]]],


       [[[ 0.00000000e+00+0.00000000e+00j,
          -2.23863559e-01+2.80712700e-01j]]],


       [[[ 0.00000000e+00+0.00000000e+00j,
           1.24167989e-01-2.42265107e-01j]]],


       [[[ 0.00000000e+00+0.00000000e+00j,
           1.59876549e-01+9.83122639e-02j]]],


       [[[ 0.00000000e+00+0.00000000e+00j,
           1.26630832e-01+8.93053475e-02j]]]])
Coordinates:
  * orders_x      (orders_x) int64 -4 -3 -2 -1 0 1 2 3 4
  * orders_y      (orders_y) int64 0
  * f             (f) float64 7.207e+14
  * polarization  (polarization) &lt;U1 's' 'p'
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=ef82d3ea-d0f9-44af-a9be-29b35ff529ea">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Reference-results">Reference results<a class="anchor-link" href="#Reference-results">¶</a></h3><p>To validate the accuracy of the results from Tidy3D, We will now compute the grating efficiency using the <a href="https://grcwa.readthedocs.io/en/latest/index.html" target="_blank">grcwa</a> package. Be sure to install it in your Python environment first: <code>pip install grcwa</code>.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=b5608dc9-3a45-4258-bd34-5c5068e54fbc">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">[8]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">grcwa</span>

<span class="c1"># Define lattice constants - size of the domain</span>
<span class="c1"># grcwa requires a finite non-zero size along each dimension</span>
<span class="n">size_y</span> <span class="o">=</span> <span class="mf">1e-3</span>
<span class="n">L1</span> <span class="o">=</span> <span class="p">[</span><span class="n">sim_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">L2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">size_y</span><span class="p">]</span>

<span class="c1"># Set truncation order</span>
<span class="n">nG</span> <span class="o">=</span> <span class="mi">300</span>

<span class="c1"># Set up RCWA object</span>
<span class="n">freq</span> <span class="o">=</span> <span class="n">f0</span> <span class="o">/</span> <span class="n">td</span><span class="o">.</span><span class="n">C_0</span>  <span class="c1"># grcwa uses normalized coordinates where the speed of light is 1</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">grcwa</span><span class="o">.</span><span class="n">obj</span><span class="p">(</span><span class="n">nG</span><span class="p">,</span> <span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Set up the geometry (the layers are ordered top to bottom in grcwa)</span>
<span class="n">num_patterned_layers</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">thick_top</span> <span class="o">=</span> <span class="n">space_above</span>
<span class="n">thick_layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">height_layer1</span><span class="p">,</span> <span class="n">height_layer2</span><span class="p">,</span> <span class="n">height_substrate</span><span class="p">]</span>
<span class="n">thick_bot</span> <span class="o">=</span> <span class="n">space_below</span>

<span class="c1"># Discretization points along x and y</span>
<span class="n">num_x</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">num_y</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1"># Permittivity info</span>
<span class="n">eps_background</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">eps_diel</span> <span class="o">=</span> <span class="n">index</span><span class="o">**</span><span class="mi">2</span>

<span class="c1"># Add the layers to the grcwa model</span>
<span class="n">obj</span><span class="o">.</span><span class="n">Add_LayerUniform</span><span class="p">(</span><span class="n">thick_top</span><span class="p">,</span> <span class="n">eps_background</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_patterned_layers</span><span class="p">):</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">Add_LayerGrid</span><span class="p">(</span><span class="n">thick_layers</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">)</span>
<span class="n">obj</span><span class="o">.</span><span class="n">Add_LayerUniform</span><span class="p">(</span><span class="n">thick_bot</span><span class="p">,</span> <span class="n">eps_background</span><span class="p">)</span>

<span class="n">obj</span><span class="o">.</span><span class="n">Init_Setup</span><span class="p">(</span><span class="n">Gmethod</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="k">if</span> <span class="n">structures</span> <span class="o">==</span> <span class="p">[]:</span>
    <span class="n">eps_grid_substrate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">))</span> <span class="o">*</span> <span class="n">eps_background</span>
    <span class="n">eps_grid_L1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">))</span> <span class="o">*</span> <span class="n">eps_background</span>
    <span class="n">eps_grid_L2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">))</span> <span class="o">*</span> <span class="n">eps_background</span>
<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">structures</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">eps_grid_substrate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">))</span> <span class="o">*</span> <span class="n">eps_diel</span>
    <span class="n">eps_grid_L1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">))</span> <span class="o">*</span> <span class="n">eps_background</span>
    <span class="n">eps_grid_L2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">))</span> <span class="o">*</span> <span class="n">eps_background</span>
<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">structures</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">eps_grid_substrate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">))</span> <span class="o">*</span> <span class="n">eps_diel</span>
    <span class="n">eps_grid_L1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">))</span> <span class="o">*</span> <span class="n">eps_diel</span>
    <span class="n">eps_grid_L2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">))</span> <span class="o">*</span> <span class="n">eps_background</span>
<span class="k">else</span><span class="p">:</span>

    <span class="n">eps_grid_substrate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">))</span> <span class="o">*</span> <span class="n">eps_diel</span>
    <span class="n">eps_grid_L1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">))</span> <span class="o">*</span> <span class="n">eps_diel</span>
    <span class="n">eps_grid_L2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">))</span> <span class="o">*</span> <span class="n">eps_diel</span>

    <span class="c1"># For each layer, we need to create a permittivity mask</span>
    <span class="n">sim_center_rcwa</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">center</span>
    <span class="n">sim_size_rcwa</span> <span class="o">=</span> <span class="p">[</span><span class="n">sim_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size_y</span><span class="p">]</span>

    <span class="c1"># Create a grid of all possible coordinates</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
        <span class="n">sim_center_rcwa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">sim_size_rcwa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">sim_center_rcwa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sim_size_rcwa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">num_x</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
        <span class="n">sim_center_rcwa</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">sim_size_rcwa</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">sim_center_rcwa</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">sim_size_rcwa</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">num_y</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">x_sim</span><span class="p">,</span> <span class="n">y_sim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">"ij"</span><span class="p">)</span>

    <span class="c1"># Now mask out the coordinates that correspond to the dielectric regions</span>
    <span class="n">center_L1</span> <span class="o">=</span> <span class="n">grating_L1</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">center</span>
    <span class="n">size_L1</span> <span class="o">=</span> <span class="n">grating_L1</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">size</span>

    <span class="n">center_L2</span> <span class="o">=</span> <span class="n">grating_L2</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">center</span>
    <span class="n">size_L2</span> <span class="o">=</span> <span class="n">grating_L2</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">size</span>

    <span class="k">def</span> <span class="nf">get_ind</span><span class="p">(</span><span class="n">x_grid</span><span class="p">,</span> <span class="n">y_grid</span><span class="p">,</span> <span class="n">diel_center</span><span class="p">,</span> <span class="n">diel_size</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Get the anti-mask indices for a given dielectric slab."""</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span>
            <span class="p">(</span><span class="n">x_grid</span> <span class="o">&lt;</span> <span class="n">diel_center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">diel_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="o">|</span> <span class="p">(</span><span class="n">x_grid</span> <span class="o">&gt;</span> <span class="n">diel_center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">diel_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="o">|</span> <span class="p">(</span><span class="n">y_grid</span> <span class="o">&lt;</span> <span class="n">diel_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">diel_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="o">|</span> <span class="p">(</span><span class="n">y_grid</span> <span class="o">&gt;</span> <span class="n">diel_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">diel_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">ind</span>

    <span class="n">ind_L1</span> <span class="o">=</span> <span class="n">get_ind</span><span class="p">(</span><span class="n">x_sim</span><span class="p">,</span> <span class="n">x_sim</span><span class="p">,</span> <span class="n">center_L1</span><span class="p">,</span> <span class="n">size_L1</span><span class="p">)</span>
    <span class="n">ind_L2</span> <span class="o">=</span> <span class="n">get_ind</span><span class="p">(</span><span class="n">x_sim</span><span class="p">,</span> <span class="n">x_sim</span><span class="p">,</span> <span class="n">center_L2</span><span class="p">,</span> <span class="n">size_L2</span><span class="p">)</span>

    <span class="n">eps_grid_L1</span><span class="p">[</span><span class="n">ind_L1</span><span class="p">]</span> <span class="o">=</span> <span class="n">eps_background</span>
    <span class="n">eps_grid_L2</span><span class="p">[</span><span class="n">ind_L2</span><span class="p">]</span> <span class="o">=</span> <span class="n">eps_background</span>

<span class="c1"># Combine the three layer masks</span>
<span class="n">eps_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
    <span class="p">(</span><span class="n">eps_grid_L2</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">eps_grid_L1</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">eps_grid_substrate</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
<span class="p">)</span>

<span class="c1"># Apply these material masks to the model</span>
<span class="n">obj</span><span class="o">.</span><span class="n">GridLayer_geteps</span><span class="p">(</span><span class="n">eps_grid</span><span class="p">)</span>

<span class="c1"># Set up the s-polarized plane wave source</span>
<span class="n">planewave</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"p_amp"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"s_amp"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"p_phase"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"s_phase"</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="n">obj</span><span class="o">.</span><span class="n">MakeExcitationPlanewave</span><span class="p">(</span>
    <span class="n">planewave</span><span class="p">[</span><span class="s2">"p_amp"</span><span class="p">],</span>
    <span class="n">planewave</span><span class="p">[</span><span class="s2">"p_phase"</span><span class="p">],</span>
    <span class="n">planewave</span><span class="p">[</span><span class="s2">"s_amp"</span><span class="p">],</span>
    <span class="n">planewave</span><span class="p">[</span><span class="s2">"s_phase"</span><span class="p">],</span>
    <span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Run grcwa to get the reflection and transmission efficiencies by order</span>
<span class="n">R</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">RT_Solve</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Ri</span><span class="p">,</span> <span class="n">Ti</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">RT_Solve</span><span class="p">(</span><span class="n">byorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">rcwa_order_index</span><span class="p">(</span><span class="n">orders_x</span><span class="p">,</span> <span class="n">orders_y</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">rcwa_data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Helper function to extract data corresponding to particular order pairs."""</span>
    <span class="n">ords</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">out_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">order_y</span> <span class="ow">in</span> <span class="n">orders_y</span><span class="p">:</span>
        <span class="n">ords</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        <span class="n">out_data</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">order_x</span> <span class="ow">in</span> <span class="n">orders_x</span><span class="p">:</span>
            <span class="n">order</span> <span class="o">=</span> <span class="p">[</span><span class="n">order_x</span><span class="p">,</span> <span class="n">order_y</span><span class="p">]</span>
            <span class="n">ords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">order</span><span class="p">))</span>
            <span class="n">out_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rcwa_data</span><span class="p">[</span><span class="n">ords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]]))</span>
    <span class="k">return</span> <span class="n">ords</span><span class="p">,</span> <span class="n">out_data</span>


<span class="c1"># Extract grcwa results at orders corresponding to those computed above by Tidy3D</span>
<span class="n">r_ords</span><span class="p">,</span> <span class="n">Ri_by_order</span> <span class="o">=</span> <span class="n">rcwa_order_index</span><span class="p">(</span>
    <span class="n">data_r</span><span class="o">.</span><span class="n">orders_x</span><span class="p">,</span>
    <span class="n">data_r</span><span class="o">.</span><span class="n">orders_y</span><span class="p">,</span>
    <span class="n">obj</span><span class="p">,</span>
    <span class="n">Ri</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">t_ords</span><span class="p">,</span> <span class="n">Ti_by_order</span> <span class="o">=</span> <span class="n">rcwa_order_index</span><span class="p">(</span>
    <span class="n">data_t</span><span class="o">.</span><span class="n">orders_x</span><span class="p">,</span>
    <span class="n">data_t</span><span class="o">.</span><span class="n">orders_y</span><span class="p">,</span>
    <span class="n">obj</span><span class="p">,</span>
    <span class="n">Ti</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=3646f5cf-4815-4c7b-bda5-21f70ab69da3">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Plot-and-compare-diffracted-power">Plot and compare diffracted power<a class="anchor-link" href="#Plot-and-compare-diffracted-power">¶</a></h3><p>Since this is essentially a 1D grating along <code>x</code>, we'll plot the power, which is normalized and corresponds to the grating efficiency, as a function of <code>x</code> for order 0 in <code>y</code>. The results are in excellent agreement with each other.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=b565b58a-0f4e-4bc6-a192-3f0c28b6c145">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">[9]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="n">orders_x</span> <span class="o">=</span> <span class="n">data_r</span><span class="o">.</span><span class="n">orders_x</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">orders_x</span><span class="p">,</span> <span class="n">data_r</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">orders_y</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="s2">"o-"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Tidy3D"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">orders_x</span><span class="p">,</span> <span class="n">Ri_by_order</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">"s--"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"grcwa"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Reflection"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Order along x"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">orders_x</span> <span class="o">=</span> <span class="n">data_t</span><span class="o">.</span><span class="n">orders_x</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">orders_x</span><span class="p">,</span> <span class="n">data_t</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">orders_y</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="s2">"o-"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Tidy3D"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">orders_x</span><span class="p">,</span> <span class="n">Ti_by_order</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">"s--"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"grcwa"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Transmission"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Order along x"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedImage jp-OutputArea-output" tabindex="0">
<img alt="No description has been provided for this image" class="" src="/assets/tidy3d/examples/image/GratingEfficiency/GratingEfficiency_2.png"/>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=25dc4a93-6acd-45e6-affa-f7c347dae7dd">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Plot-and-compare-power-amplitudes">Plot and compare power amplitudes<a class="anchor-link" href="#Plot-and-compare-power-amplitudes">¶</a></h3><p>We can also compare the transmitted complex power amplitude for each order and each polarization to those obtained via the <a href="https://grcwa.readthedocs.io/en/latest/index.html" target="_blank">grcwa</a> package. The power amplitudes are complex and provide information about the phase difference among different orders.</p>
<p>Note that grcwa returns fields in Cartesian coordinates, while Tidy3D returns power amplitudes in the <code>s</code> and <code>p</code> polarization basis. Therefore, we will use some convenience methods to convert grcwa's fields to spherical coordinates before comparing the two solvers.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=6acbd424-181c-47d6-aa4c-b78591b2e493">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">[10]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>

<span class="c1"># get amplitudes from Tidy3D results</span>
<span class="n">amps_sp</span> <span class="o">=</span> <span class="n">data_t</span><span class="o">.</span><span class="n">amps</span>

<span class="c1"># get amplitudes from grcwa</span>

<span class="c1"># we're sampling near-fields in the lower-most layer</span>
<span class="n">layer</span> <span class="o">=</span> <span class="mi">4</span>
<span class="c1"># position above the simulation domain's bottom where we're sampling</span>
<span class="n">z_offset</span> <span class="o">=</span> <span class="n">monitor_t</span><span class="o">.</span><span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="n">sim_size</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">amps_grcwa_xy</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Solve_FieldFourier</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">z_offset</span><span class="p">)</span>

<span class="c1"># Extract grcwa results at orders corresponding to those computed by Tidy3D</span>
<span class="n">amps_grcwa_xy</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rcwa_order_index</span><span class="p">(</span><span class="n">data_t</span><span class="o">.</span><span class="n">orders_x</span><span class="p">,</span> <span class="n">data_t</span><span class="o">.</span><span class="n">orders_y</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">amps</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">amps</span> <span class="ow">in</span> <span class="n">amps_grcwa_xy</span>
<span class="p">]</span>

<span class="c1"># we need to swap the axes as below for the data to match Tidy3D data</span>
<span class="n">amps_grcwa_xy</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">amps</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">amps</span> <span class="ow">in</span> <span class="n">amps_grcwa_xy</span><span class="p">]</span>

<span class="c1"># to match the format of Tidy3D data, add a frequency dimension</span>
<span class="n">amps_grcwa_xy</span> <span class="o">=</span> <span class="p">[</span><span class="n">amps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">amps</span> <span class="ow">in</span> <span class="n">amps_grcwa_xy</span><span class="p">]</span>

<span class="c1"># convert to spherical coordinates</span>
<span class="n">theta</span><span class="p">,</span> <span class="n">phi</span> <span class="o">=</span> <span class="n">data_t</span><span class="o">.</span><span class="n">angles</span>
<span class="n">amps_grcwa_tp</span> <span class="o">=</span> <span class="n">data_t</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">car_2_sph_field</span><span class="p">(</span>
    <span class="n">amps_grcwa_xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">amps_grcwa_xy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">amps_grcwa_xy</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">theta</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">phi</span><span class="o">.</span><span class="n">values</span>
<span class="p">)</span>

<span class="c1"># make an xarray dataset for the rcwa amplitudes</span>
<span class="n">coords</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">coords</span><span class="p">[</span><span class="s2">"orders_x"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">data_t</span><span class="o">.</span><span class="n">orders_x</span><span class="p">)</span>
<span class="n">coords</span><span class="p">[</span><span class="s2">"orders_y"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">data_t</span><span class="o">.</span><span class="n">orders_y</span><span class="p">)</span>
<span class="n">coords</span><span class="p">[</span><span class="s2">"f"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_t</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
<span class="n">coords</span><span class="p">[</span><span class="s2">"polarization"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"s"</span><span class="p">,</span> <span class="s2">"p"</span><span class="p">]</span>
<span class="n">amps_grcwa_sp</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">amps_grcwa_tp</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">amps_grcwa_tp</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="n">coords</span><span class="o">=</span><span class="n">coords</span>
<span class="p">)</span>

<span class="c1"># finally, we can compare the complex amplitudes for the y=0 order, as a function of orders along x</span>
<span class="n">pol</span> <span class="o">=</span> <span class="s2">"p"</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">orders_x</span> <span class="o">=</span> <span class="n">data_t</span><span class="o">.</span><span class="n">orders_x</span>
<span class="n">data_tidy3d</span> <span class="o">=</span> <span class="n">data_t</span><span class="o">.</span><span class="n">amps</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">polarization</span><span class="o">=</span><span class="n">pol</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">data_grcwa</span> <span class="o">=</span> <span class="n">amps_grcwa_sp</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">polarization</span><span class="o">=</span><span class="n">pol</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">orders_x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">data_tidy3d</span><span class="p">),</span> <span class="s2">"o-"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Tidy3D"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">orders_x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">data_grcwa</span><span class="p">),</span> <span class="s2">"s--"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"grcwa"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">pol</span><span class="si">}</span><span class="s2">-pol, real part"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Transmission"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Order along x"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">orders_x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">data_tidy3d</span><span class="p">),</span> <span class="s2">"o-"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Tidy3D"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">orders_x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">data_grcwa</span><span class="p">),</span> <span class="s2">"s--"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"grcwa"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">pol</span><span class="si">}</span><span class="s2">-pol, imag part"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"Transmission"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Order along x"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedImage jp-OutputArea-output" tabindex="0">
<img alt="No description has been provided for this image" class="" src="/assets/tidy3d/examples/image/GratingEfficiency/GratingEfficiency_3.png"/>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=033a8fd6-03c5-427b-818a-9f7a23b12b0b">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Plot-Field-Distributions">Plot Field Distributions<a class="anchor-link" href="#Plot-Field-Distributions">¶</a></h3><p>Plot the frequency-domain electric field components at the center frequency along an <code>xz</code> cut of the domain. The <code>y</code> component is zero everywhere because the wave is entirely <code>x</code>-polarized.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=1b736593-d3e0-4c46-a4a1-bc642ce9ee29">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">[11]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">sim_data</span><span class="p">[</span><span class="s2">"field_xz"</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sim_data</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">sim_data</span><span class="o">.</span><span class="n">plot_field</span><span class="p">(</span><span class="s2">"field_xz"</span><span class="p">,</span> <span class="n">field_name</span><span class="o">=</span><span class="s2">"Ex"</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="s2">"abs"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">sim_data</span><span class="o">.</span><span class="n">plot_field</span><span class="p">(</span><span class="s2">"field_xz"</span><span class="p">,</span> <span class="n">field_name</span><span class="o">=</span><span class="s2">"Ey"</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="s2">"abs"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">sim_data</span><span class="o">.</span><span class="n">plot_field</span><span class="p">(</span><span class="s2">"field_xz"</span><span class="p">,</span> <span class="n">field_name</span><span class="o">=</span><span class="s2">"Ez"</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="s2">"abs"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedImage jp-OutputArea-output" tabindex="0">
<img alt="No description has been provided for this image" class="" src="/assets/tidy3d/examples/image/GratingEfficiency/GratingEfficiency_4.png"/>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=e6fabbff">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2 id="Off-normal-incidence">Off-normal incidence<a class="anchor-link" href="#Off-normal-incidence">¶</a></h2><p>To study a diffraction grating under an angled illumination, we need to use Bloch boundary conditions along the <code>x</code> and <code>y</code> directions that match the incoming wave. The Bloch vector can be automatically computed based on the plane wave parameters, as shown below.</p>
<p>If the illumination is such that the angle is non-zero along y, a slightly special treatment is required in that we cannot set the simulation size to zero in that direction anymore. Instead we should define the simulation length to be a small finite value, and set the mesh step in that direction to the same value.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=93287773">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">[12]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Angles</span>
<span class="n">angle_theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">10</span>
<span class="n">angle_phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">3</span>

<span class="c1"># Simulation size</span>
<span class="n">length_y</span> <span class="o">=</span> <span class="mf">0.01</span>  <span class="c1"># needed when angle_phi is not zero</span>
<span class="n">sim_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">length_x</span><span class="p">,</span> <span class="n">length_y</span><span class="p">,</span> <span class="n">length_z</span><span class="p">)</span>

<span class="c1"># Angled source</span>
<span class="n">src_z</span> <span class="o">=</span> <span class="n">length_z</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">space_above</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">angle_theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">10</span>
<span class="n">source</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">PlaneWave</span><span class="p">(</span>
    <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">src_z</span><span class="p">),</span>
    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">td</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">source_time</span><span class="o">=</span><span class="n">gaussian</span><span class="p">,</span>
    <span class="n">direction</span><span class="o">=</span><span class="s2">"-"</span><span class="p">,</span>
    <span class="n">pol_angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">angle_theta</span><span class="o">=</span><span class="n">angle_theta</span><span class="p">,</span>
    <span class="n">angle_phi</span><span class="o">=</span><span class="n">angle_phi</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Boundaries</span>
<span class="n">bloch_x</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">Boundary</span><span class="o">.</span><span class="n">bloch_from_source</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">domain_size</span><span class="o">=</span><span class="n">sim_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">bloch_y</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">Boundary</span><span class="o">.</span><span class="n">bloch_from_source</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">domain_size</span><span class="o">=</span><span class="n">sim_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">boundary_spec</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">BoundarySpec</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">bloch_x</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">bloch_y</span><span class="p">,</span>
    <span class="n">z</span><span class="o">=</span><span class="n">td</span><span class="o">.</span><span class="n">Boundary</span><span class="p">(</span>
        <span class="n">minus</span><span class="o">=</span><span class="n">td</span><span class="o">.</span><span class="n">PML</span><span class="p">(</span><span class="n">num_layers</span><span class="o">=</span><span class="n">num_pml_layers</span><span class="p">),</span> <span class="n">plus</span><span class="o">=</span><span class="n">td</span><span class="o">.</span><span class="n">PML</span><span class="p">(</span><span class="n">num_layers</span><span class="o">=</span><span class="n">num_pml_layers</span><span class="p">)</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="c1"># Simulation</span>
<span class="n">simulation</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span>
    <span class="n">size</span><span class="o">=</span><span class="n">sim_size</span><span class="p">,</span>
    <span class="n">grid_spec</span><span class="o">=</span><span class="n">td</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span>
        <span class="n">grid_x</span><span class="o">=</span><span class="n">td</span><span class="o">.</span><span class="n">AutoGrid</span><span class="p">(</span><span class="n">min_steps_per_wvl</span><span class="o">=</span><span class="mi">60</span><span class="p">),</span>
        <span class="n">grid_y</span><span class="o">=</span><span class="n">td</span><span class="o">.</span><span class="n">UniformGrid</span><span class="p">(</span><span class="n">dl</span><span class="o">=</span><span class="n">sim_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">grid_z</span><span class="o">=</span><span class="n">td</span><span class="o">.</span><span class="n">AutoGrid</span><span class="p">(</span><span class="n">min_steps_per_wvl</span><span class="o">=</span><span class="mi">60</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">structures</span><span class="o">=</span><span class="n">structures</span><span class="p">,</span>
    <span class="n">sources</span><span class="o">=</span><span class="p">[</span><span class="n">source</span><span class="p">],</span>
    <span class="n">monitors</span><span class="o">=</span><span class="n">monitors</span><span class="p">,</span>
    <span class="n">run_time</span><span class="o">=</span><span class="n">run_time</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">boundary_spec</span><span class="o">=</span><span class="n">boundary_spec</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">simulation</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedImage jp-OutputArea-output" tabindex="0">
<img alt="No description has been provided for this image" class="" src="/assets/tidy3d/examples/image/GratingEfficiency/GratingEfficiency_5.png"/>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=f75e1cb4">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">[13]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">sim_data</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="n">simulation</span><span class="p">,</span>
    <span class="n">task_name</span><span class="o">=</span><span class="s2">"GratingEfficiency"</span><span class="p">,</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">"data/GratingEfficiency.hdf5"</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">[13:02:36] </span><span style="color: #800000; text-decoration-color: #800000">WARNING: Simulation has </span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1.07e+06</span><span style="color: #800000; text-decoration-color: #800000"> time steps. The   </span> <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/components/simulation.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">simulation.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/components/simulation.py#948" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">948</span></a>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><span style="color: #008000; text-decoration-color: #008000">'run_time'</span><span style="color: #800000; text-decoration-color: #800000"> may be unnecessarily large, unless there</span> <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">                 </span>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><span style="color: #800000; text-decoration-color: #800000">are very long-lived resonances.                    </span> <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">                 </span>
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>Created task <span style="color: #008000; text-decoration-color: #008000">'GratingEfficiency'</span> with task_id           <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">webapi.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py#188" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">188</span></a>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><span style="color: #008000; text-decoration-color: #008000">'fdve-5dc74356-fbea-47e7-8d40-fd63001422eav1'</span>.          <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">             </span>
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>View task using web UI at                               <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">webapi.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py#190" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">190</span></a>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><a href="https://tidy3d.simulation.cloud/workbench?taskId=fdve-5dc74356-fbea-47e7-8d40-fd63001422eav1" target="_blank"><span style="color: #008000; text-decoration-color: #008000">'https://tidy3d.simulation.cloud/workbench?taskId=fdve-</span></a> <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">             </span>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><a href="https://tidy3d.simulation.cloud/workbench?taskId=fdve-5dc74356-fbea-47e7-8d40-fd63001422eav1" target="_blank"><span style="color: #008000; text-decoration-color: #008000">5dc74356-fbea-47e7-8d40-fd63001422eav1'</span></a>.                <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">             </span>
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jupyter-widgets jp-OutputArea-output" id="98ff586c-9849-4267-9bc0-d5405088b787" tabindex="0">
<script type="text/javascript">
var element = document.getElementById('98ff586c-9849-4267-9bc0-d5405088b787');
</script>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "fc8cf21464424c9f97253af834343e4d", "version_major": 2, "version_minor": 0}
</script>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">[13:02:37] </span>status = queued                                         <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">webapi.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py#361" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">361</span></a>
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jupyter-widgets jp-OutputArea-output" id="ff46c3fd-b540-431e-ad4b-5741382ef25f" tabindex="0">
<script type="text/javascript">
var element = document.getElementById('ff46c3fd-b540-431e-ad4b-5741382ef25f');
</script>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "e44548ee41b547579a2ba0b517732be5", "version_major": 2, "version_minor": 0}
</script>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">[13:02:46] </span>status = preprocess                                     <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">webapi.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py#355" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">355</span></a>
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">[13:02:50] </span>Maximum FlexCredit cost: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">0.649</span>. Use                     <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">webapi.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py#341" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">341</span></a>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><span style="color: #008000; text-decoration-color: #008000">'web.real_cost(task_id)'</span> to get the billed FlexCredit   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">             </span>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>cost after a simulation run.                            <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">             </span>
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>starting up solver                                      <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">webapi.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py#377" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">377</span></a>
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>running solver                                          <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">webapi.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py#386" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">386</span></a>
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>To cancel the simulation, use <span style="color: #008000; text-decoration-color: #008000">'web.abort(task_id)'</span> or   <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">webapi.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py#387" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">387</span></a>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span><span style="color: #008000; text-decoration-color: #008000">'web.delete(task_id)'</span> or abort/delete the task in the   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">             </span>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>web UI. Terminating the Python script will not stop the <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">             </span>
<span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>job running on the cloud.                               <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">             </span>
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jupyter-widgets jp-OutputArea-output" id="d3776dce-436a-4b26-9d3a-12e9adaaf91d" tabindex="0">
<script type="text/javascript">
var element = document.getElementById('d3776dce-436a-4b26-9d3a-12e9adaaf91d');
</script>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "71759149ba764703910192c0eada2d90", "version_major": 2, "version_minor": 0}
</script>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">[13:06:42] </span>early shutoff detected, exiting.                        <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">webapi.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py#404" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">404</span></a>
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">           </span>status = postprocess                                    <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">webapi.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py#419" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">419</span></a>
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jupyter-widgets jp-OutputArea-output" id="ac2ebb78-fefc-46cf-971a-73706fcce1af" tabindex="0">
<script type="text/javascript">
var element = document.getElementById('ac2ebb78-fefc-46cf-971a-73706fcce1af');
</script>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "9922f87f2f304736b316baeaf6e1863d", "version_major": 2, "version_minor": 0}
</script>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">[13:06:52] </span>status = success                                        <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">webapi.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py#426" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">426</span></a>
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jupyter-widgets jp-OutputArea-output" id="6c4b939b-045f-43eb-acd1-cd7bad45f8b7" tabindex="0">
<script type="text/javascript">
var element = document.getElementById('6c4b939b-045f-43eb-acd1-cd7bad45f8b7');
</script>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "b8af708186714bebbb32882c4e8b80cd", "version_major": 2, "version_minor": 0}
</script>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #7fbfbf; text-decoration-color: #7fbfbf">[13:06:54] </span>loading SimulationData from data/GratingEfficiency.hdf5 <a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">webapi.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///home/momchil/Drive/flexcompute/tidy3d-docs/tidy3d/tidy3d/web/webapi.py#590" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">590</span></a>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=395b366f-b2fe-4b38-9ed4-67f656d7e2e3">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Let's look at the same data as before.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=5862a5ee">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">[14]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">data_r</span> <span class="o">=</span> <span class="n">sim_data</span><span class="p">[</span><span class="s2">"reflection"</span><span class="p">]</span>
<span class="n">data_t</span> <span class="o">=</span> <span class="n">sim_data</span><span class="p">[</span><span class="s2">"transmission"</span><span class="p">]</span>
<span class="n">total_power</span> <span class="o">=</span> <span class="n">data_r</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">data_t</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">data_t</span><span class="o">.</span><span class="n">angles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Total power: </span><span class="si">{</span><span class="n">total_power</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Theta (degrees):"</span><span class="p">,</span> <span class="s2">", "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">theta</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Amplitude data: </span><span class="se">\n</span><span class="si">{</span><span class="n">data_t</span><span class="o">.</span><span class="n">amps</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Total power: 1.0004565690665397
Theta (degrees): 59.97, 41.10, 27.56, 18.00, 16.04, 23.30, 35.43, 51.66, 85.40
Amplitude data: 
&lt;xarray.DataArray (orders_x: 9, orders_y: 1, f: 1, polarization: 2)&gt;
array([[[[-0.05665493+0.05396016j, -0.08838092+0.03289017j]]],


       [[[ 0.0323857 +0.14690695j,  0.07479949+0.24760187j]]],


       [[[-0.08489925-0.16558103j, -0.25393611-0.37732615j]]],


       [[[ 0.01335748-0.007025j  , -0.44106982+0.21495525j]]],


       [[[ 0.08297153+0.25086151j, -0.08892781-0.31277037j]]],


       [[[ 0.14512969-0.20704795j, -0.05329311+0.06908235j]]],


       [[[-0.01251338+0.08233134j, -0.02004684+0.01583912j]]],


       [[[-0.02789944-0.17131001j, -0.04803801+0.01526744j]]],


       [[[ 0.06932621-0.07540927j,  0.00913665-0.00717848j]]]])
Coordinates:
  * orders_x      (orders_x) int64 -3 -2 -1 0 1 2 3 4 5
  * orders_y      (orders_y) int64 0
  * f             (f) float64 7.207e+14
  * polarization  (polarization) &lt;U1 's' 'p'
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=6c21f383">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>We still used a P-polarized source (<code>pol_angle = 0</code> in the source defition), but now we also get nonzero <code>polarization = "s"</code> amplitudes in the data. This is because the input polarization is at an angle with respect to the <code>x</code>-axis, and is not preserved by the translational invariance along <code>y</code>. Similarly, now there is a nonzero <code>Ey</code> field component in the recorded near fields.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=ec58bb76">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">[15]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">sim_data</span><span class="p">[</span><span class="s2">"field_xz"</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sim_data</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">sim_data</span><span class="o">.</span><span class="n">plot_field</span><span class="p">(</span><span class="s2">"field_xz"</span><span class="p">,</span> <span class="n">field_name</span><span class="o">=</span><span class="s2">"Ex"</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="s2">"abs"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">sim_data</span><span class="o">.</span><span class="n">plot_field</span><span class="p">(</span><span class="s2">"field_xz"</span><span class="p">,</span> <span class="n">field_name</span><span class="o">=</span><span class="s2">"Ey"</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="s2">"abs"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">sim_data</span><span class="o">.</span><span class="n">plot_field</span><span class="p">(</span><span class="s2">"field_xz"</span><span class="p">,</span> <span class="n">field_name</span><span class="o">=</span><span class="s2">"Ez"</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="s2">"abs"</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedImage jp-OutputArea-output" tabindex="0">
<img alt="No description has been provided for this image" class="" src="/assets/tidy3d/examples/image/GratingEfficiency/GratingEfficiency_6.png"/>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=9cd70d4e">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h3 id="Comparison-to-RCWA">Comparison to RCWA<a class="anchor-link" href="#Comparison-to-RCWA">¶</a></h3><p>We can also compare to RCWA results as before. Note that, because we are injecting backwards, we need to add an <code>np.pi</code> to <code>angle_theta</code> in the <code>grcwa</code> computation.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=bf5f39aa">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">[16]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Define lattice constants - size of the domain</span>
<span class="c1"># grcwa requires a finite non-zero size along each dimension</span>
<span class="n">size_y</span> <span class="o">=</span> <span class="mf">1e-3</span>
<span class="n">L1</span> <span class="o">=</span> <span class="p">[</span><span class="n">sim_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">L2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">size_y</span><span class="p">]</span>

<span class="c1"># Set truncation order</span>
<span class="n">nG</span> <span class="o">=</span> <span class="mi">300</span>

<span class="c1"># Set up RCWA object</span>
<span class="n">freq</span> <span class="o">=</span> <span class="n">f0</span> <span class="o">/</span> <span class="n">td</span><span class="o">.</span><span class="n">C_0</span>  <span class="c1"># grcwa uses normalized coordinates where the speed of light is 1</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">grcwa</span><span class="o">.</span><span class="n">obj</span><span class="p">(</span><span class="n">nG</span><span class="p">,</span> <span class="n">L1</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">angle_theta</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">angle_phi</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Set up the geometry (the layers are ordered top to bottom in grcwa)</span>
<span class="n">num_patterned_layers</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">thick_top</span> <span class="o">=</span> <span class="n">space_above</span>
<span class="n">thick_layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">height_layer1</span><span class="p">,</span> <span class="n">height_layer2</span><span class="p">,</span> <span class="n">height_substrate</span><span class="p">]</span>
<span class="n">thick_bot</span> <span class="o">=</span> <span class="n">space_below</span>

<span class="c1"># Discretization points along x and y</span>
<span class="n">num_x</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">num_y</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1"># Permittivity info</span>
<span class="n">eps_background</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">eps_diel</span> <span class="o">=</span> <span class="n">index</span><span class="o">**</span><span class="mi">2</span>

<span class="c1"># Add the layers to the grcwa model</span>
<span class="n">obj</span><span class="o">.</span><span class="n">Add_LayerUniform</span><span class="p">(</span><span class="n">thick_top</span><span class="p">,</span> <span class="n">eps_background</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_patterned_layers</span><span class="p">):</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">Add_LayerGrid</span><span class="p">(</span><span class="n">thick_layers</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">)</span>
<span class="n">obj</span><span class="o">.</span><span class="n">Add_LayerUniform</span><span class="p">(</span><span class="n">thick_bot</span><span class="p">,</span> <span class="n">eps_background</span><span class="p">)</span>

<span class="n">obj</span><span class="o">.</span><span class="n">Init_Setup</span><span class="p">(</span><span class="n">Gmethod</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="k">if</span> <span class="n">structures</span> <span class="o">==</span> <span class="p">[]:</span>
    <span class="n">eps_grid_substrate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">))</span> <span class="o">*</span> <span class="n">eps_background</span>
    <span class="n">eps_grid_L1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">))</span> <span class="o">*</span> <span class="n">eps_background</span>
    <span class="n">eps_grid_L2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">))</span> <span class="o">*</span> <span class="n">eps_background</span>
<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">structures</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">eps_grid_substrate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">))</span> <span class="o">*</span> <span class="n">eps_diel</span>
    <span class="n">eps_grid_L1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">))</span> <span class="o">*</span> <span class="n">eps_background</span>
    <span class="n">eps_grid_L2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">))</span> <span class="o">*</span> <span class="n">eps_background</span>
<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">structures</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">eps_grid_substrate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">))</span> <span class="o">*</span> <span class="n">eps_diel</span>
    <span class="n">eps_grid_L1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">))</span> <span class="o">*</span> <span class="n">eps_diel</span>
    <span class="n">eps_grid_L2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">))</span> <span class="o">*</span> <span class="n">eps_background</span>
<span class="k">else</span><span class="p">:</span>

    <span class="n">eps_grid_substrate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">))</span> <span class="o">*</span> <span class="n">eps_diel</span>
    <span class="n">eps_grid_L1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">))</span> <span class="o">*</span> <span class="n">eps_diel</span>
    <span class="n">eps_grid_L2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num_x</span><span class="p">,</span> <span class="n">num_y</span><span class="p">))</span> <span class="o">*</span> <span class="n">eps_diel</span>

    <span class="c1"># For each layer, we need to create a permittivity mask</span>
    <span class="n">sim_center_rcwa</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">center</span>
    <span class="n">sim_size_rcwa</span> <span class="o">=</span> <span class="p">[</span><span class="n">sim_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size_y</span><span class="p">]</span>

    <span class="c1"># Create a grid of all possible coordinates</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
        <span class="n">sim_center_rcwa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">sim_size_rcwa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">sim_center_rcwa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sim_size_rcwa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">num_x</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
        <span class="n">sim_center_rcwa</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">sim_size_rcwa</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">sim_center_rcwa</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">sim_size_rcwa</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">num_y</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">x_sim</span><span class="p">,</span> <span class="n">y_sim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">"ij"</span><span class="p">)</span>

    <span class="c1"># Now mask out the coordinates that correspond to the dielectric regions</span>
    <span class="n">center_L1</span> <span class="o">=</span> <span class="n">grating_L1</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">center</span>
    <span class="n">size_L1</span> <span class="o">=</span> <span class="n">grating_L1</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">size</span>

    <span class="n">center_L2</span> <span class="o">=</span> <span class="n">grating_L2</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">center</span>
    <span class="n">size_L2</span> <span class="o">=</span> <span class="n">grating_L2</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">size</span>

    <span class="k">def</span> <span class="nf">get_ind</span><span class="p">(</span><span class="n">x_grid</span><span class="p">,</span> <span class="n">y_grid</span><span class="p">,</span> <span class="n">diel_center</span><span class="p">,</span> <span class="n">diel_size</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Get the anti-mask indices for a given dielectric slab."""</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span>
            <span class="p">(</span><span class="n">x_grid</span> <span class="o">&lt;</span> <span class="n">diel_center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">diel_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="o">|</span> <span class="p">(</span><span class="n">x_grid</span> <span class="o">&gt;</span> <span class="n">diel_center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">diel_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="o">|</span> <span class="p">(</span><span class="n">y_grid</span> <span class="o">&lt;</span> <span class="n">diel_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">diel_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="o">|</span> <span class="p">(</span><span class="n">y_grid</span> <span class="o">&gt;</span> <span class="n">diel_center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">diel_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">ind</span>

    <span class="n">ind_L1</span> <span class="o">=</span> <span class="n">get_ind</span><span class="p">(</span><span class="n">x_sim</span><span class="p">,</span> <span class="n">x_sim</span><span class="p">,</span> <span class="n">center_L1</span><span class="p">,</span> <span class="n">size_L1</span><span class="p">)</span>
    <span class="n">ind_L2</span> <span class="o">=</span> <span class="n">get_ind</span><span class="p">(</span><span class="n">x_sim</span><span class="p">,</span> <span class="n">x_sim</span><span class="p">,</span> <span class="n">center_L2</span><span class="p">,</span> <span class="n">size_L2</span><span class="p">)</span>

    <span class="n">eps_grid_L1</span><span class="p">[</span><span class="n">ind_L1</span><span class="p">]</span> <span class="o">=</span> <span class="n">eps_background</span>
    <span class="n">eps_grid_L2</span><span class="p">[</span><span class="n">ind_L2</span><span class="p">]</span> <span class="o">=</span> <span class="n">eps_background</span>

<span class="c1"># Combine the three layer masks</span>
<span class="n">eps_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
    <span class="p">(</span><span class="n">eps_grid_L2</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">eps_grid_L1</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">eps_grid_substrate</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
<span class="p">)</span>

<span class="c1"># Apply these material masks to the model</span>
<span class="n">obj</span><span class="o">.</span><span class="n">GridLayer_geteps</span><span class="p">(</span><span class="n">eps_grid</span><span class="p">)</span>

<span class="c1"># Set up the s-polarized plane wave source</span>
<span class="n">planewave</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"p_amp"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"s_amp"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"p_phase"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"s_phase"</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="n">obj</span><span class="o">.</span><span class="n">MakeExcitationPlanewave</span><span class="p">(</span>
    <span class="n">planewave</span><span class="p">[</span><span class="s2">"p_amp"</span><span class="p">],</span>
    <span class="n">planewave</span><span class="p">[</span><span class="s2">"p_phase"</span><span class="p">],</span>
    <span class="n">planewave</span><span class="p">[</span><span class="s2">"s_amp"</span><span class="p">],</span>
    <span class="n">planewave</span><span class="p">[</span><span class="s2">"s_phase"</span><span class="p">],</span>
    <span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Run grcwa to get the reflection and transmission efficiencies by order</span>
<span class="n">R</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">RT_Solve</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Ri</span><span class="p">,</span> <span class="n">Ti</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">RT_Solve</span><span class="p">(</span><span class="n">byorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">rcwa_order_index</span><span class="p">(</span><span class="n">orders_x</span><span class="p">,</span> <span class="n">orders_y</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">rcwa_data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Helper function to extract data corresponding to particular order pairs."""</span>
    <span class="n">ords</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">out_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">order_y</span> <span class="ow">in</span> <span class="n">orders_y</span><span class="p">:</span>
        <span class="n">ords</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        <span class="n">out_data</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">order_x</span> <span class="ow">in</span> <span class="n">orders_x</span><span class="p">:</span>
            <span class="n">order</span> <span class="o">=</span> <span class="p">[</span><span class="n">order_x</span><span class="p">,</span> <span class="n">order_y</span><span class="p">]</span>
            <span class="n">ords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">order</span><span class="p">))</span>
            <span class="n">out_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rcwa_data</span><span class="p">[</span><span class="n">ords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]]))</span>
    <span class="k">return</span> <span class="n">ords</span><span class="p">,</span> <span class="n">out_data</span>


<span class="c1"># Extract grcwa results at orders corresponding to those computed above by Tidy3D</span>
<span class="n">r_ords</span><span class="p">,</span> <span class="n">Ri_by_order</span> <span class="o">=</span> <span class="n">rcwa_order_index</span><span class="p">(</span>
    <span class="n">data_r</span><span class="o">.</span><span class="n">orders_x</span><span class="p">,</span>
    <span class="n">data_r</span><span class="o">.</span><span class="n">orders_y</span><span class="p">,</span>
    <span class="n">obj</span><span class="p">,</span>
    <span class="n">Ri</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">t_ords</span><span class="p">,</span> <span class="n">Ti_by_order</span> <span class="o">=</span> <span class="n">rcwa_order_index</span><span class="p">(</span>
    <span class="n">data_t</span><span class="o">.</span><span class="n">orders_x</span><span class="p">,</span>
    <span class="n">data_t</span><span class="o">.</span><span class="n">orders_y</span><span class="p">,</span>
    <span class="n">obj</span><span class="p">,</span>
    <span class="n">Ti</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=c94e365b">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">[17]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="n">orders_x</span> <span class="o">=</span> <span class="n">data_r</span><span class="o">.</span><span class="n">orders_x</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">orders_x</span><span class="p">,</span> <span class="n">data_r</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">orders_y</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="s2">"o-"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Tidy3D"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">orders_x</span><span class="p">,</span> <span class="n">Ri_by_order</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">"s--"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"grcwa"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Reflection"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Order along x"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">orders_x</span> <span class="o">=</span> <span class="n">data_t</span><span class="o">.</span><span class="n">orders_x</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">orders_x</span><span class="p">,</span> <span class="n">data_t</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">orders_y</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="s2">"o-"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"Tidy3D"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">orders_x</span><span class="p">,</span> <span class="n">Ti_by_order</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">"s--"</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"grcwa"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">"Transmission"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"Order along x"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedImage jp-OutputArea-output" tabindex="0">
<img alt="No description has been provided for this image" class="" src="/assets/tidy3d/examples/image/GratingEfficiency/GratingEfficiency_7.png"/>
</div>
</div>
</div>
</div>
</div>
</main>
</body>
<script type="application/vnd.jupyter.widget-state+json">
{"state": {"00d93ac0c14a4c2db541419ea8e40ce0": {"model_module": "@jupyter-widgets\/base", "model_module_version": "2.0.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets\/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets\/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "05f41b6c428141eaaf02ecd9db8454e4": {"model_module": "@jupyter-widgets\/base", "model_module_version": "2.0.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets\/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets\/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "0ff704b8b1c3489e8c3a441da21c284d": {"model_module": "@jupyter-widgets\/base", "model_module_version": "2.0.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets\/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets\/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "3f6b7777e989462fa74bc33c39e7de0b": {"model_module": "@jupyter-widgets\/output", "model_module_version": "1.0.0", "model_name": "OutputModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets\/output", "_model_module_version": "1.0.0", "_model_name": "OutputModel", "_view_count": null, "_view_module": "@jupyter-widgets\/output", "_view_module_version": "1.0.0", "_view_name": "OutputView", "layout": "IPY_MODEL_b9ab73cf473e4b7493678a00eccdd925", "msg_id": "", "outputs": [{"data": {"text\/html": "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #800000; text-decoration-color: #800000; font-weight: bold\">\u2191<\/span> <span style=\"color: #000080; text-decoration-color: #000080; font-weight: bold\">simulation.hdf5.gz<\/span> <span style=\"color: #729c1f; text-decoration-color: #729c1f\">\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501<\/span> <span style=\"color: #800080; text-decoration-color: #800080\">100.0%<\/span> \u2022 <span style=\"color: #008000; text-decoration-color: #008000\">1.4\/1.4 kB<\/span> \u2022 <span style=\"color: #800000; text-decoration-color: #800000\">?<\/span> \u2022 <span style=\"color: #008080; text-decoration-color: #008080\">0:00:00<\/span>\n<\/pre>\n", "text\/plain": "\u001b[1;31m\u2191\u001b[0m \u001b[1;34msimulation.hdf5.gz\u001b[0m \u001b[38;2;114;156;31m\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u001b[0m \u001b[35m100.0%\u001b[0m \u2022 \u001b[32m1.4\/1.4 kB\u001b[0m \u2022 \u001b[31m?\u001b[0m \u2022 \u001b[36m0:00:00\u001b[0m\n"}, "metadata": {}, "output_type": "display_data"}], "tabbable": null, "tooltip": null}}, "44f323d6c8804f929974ae35ff2ca7b5": {"model_module": "@jupyter-widgets\/output", "model_module_version": "1.0.0", "model_name": "OutputModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets\/output", "_model_module_version": "1.0.0", "_model_name": "OutputModel", "_view_count": null, "_view_module": "@jupyter-widgets\/output", "_view_module_version": "1.0.0", "_view_name": "OutputView", "layout": "IPY_MODEL_cf6f543ba2da4607907a28cb77a44378", "msg_id": "", "outputs": [{"data": {"text\/html": "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #008000; text-decoration-color: #008000\">\ud83c\udfc3 <\/span> <span style=\"color: #008000; text-decoration-color: #008000; font-weight: bold\">Finishing 'GratingEfficiency'...<\/span>\n<\/pre>\n", "text\/plain": "\u001b[32m\ud83c\udfc3 \u001b[0m \u001b[1;32mFinishing 'GratingEfficiency'...\u001b[0m\n"}, "metadata": {}, "output_type": "display_data"}], "tabbable": null, "tooltip": null}}, "4d2b82a1c81f415caa28f697b4d528ab": {"model_module": "@jupyter-widgets\/output", "model_module_version": "1.0.0", "model_name": "OutputModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets\/output", "_model_module_version": "1.0.0", "_model_name": "OutputModel", "_view_count": null, "_view_module": "@jupyter-widgets\/output", "_view_module_version": "1.0.0", "_view_name": "OutputView", "layout": "IPY_MODEL_00d93ac0c14a4c2db541419ea8e40ce0", "msg_id": "", "outputs": [{"data": {"text\/html": "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #008000; text-decoration-color: #008000; font-weight: bold\">\u2193<\/span> <span style=\"color: #000080; text-decoration-color: #000080; font-weight: bold\">monitor_data.hdf5<\/span> <span style=\"color: #729c1f; text-decoration-color: #729c1f\">\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501<\/span> <span style=\"color: #800080; text-decoration-color: #800080\">100.0%<\/span> \u2022 <span style=\"color: #008000; text-decoration-color: #008000\">16.2\/16.2 MB<\/span> \u2022 <span style=\"color: #800000; text-decoration-color: #800000\">15.5 MB\/s<\/span> \u2022 <span style=\"color: #008080; text-decoration-color: #008080\">0:00:00<\/span>\n<\/pre>\n", "text\/plain": "\u001b[1;32m\u2193\u001b[0m \u001b[1;34mmonitor_data.hdf5\u001b[0m \u001b[38;2;114;156;31m\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u001b[0m \u001b[35m100.0%\u001b[0m \u2022 \u001b[32m16.2\/16.2 MB\u001b[0m \u2022 \u001b[31m15.5 MB\/s\u001b[0m \u2022 \u001b[36m0:00:00\u001b[0m\n"}, "metadata": {}, "output_type": "display_data"}], "tabbable": null, "tooltip": null}}, "6158d86fbdd742a2ad37ec44d40f2fc2": {"model_module": "@jupyter-widgets\/output", "model_module_version": "1.0.0", "model_name": "OutputModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets\/output", "_model_module_version": "1.0.0", "_model_name": "OutputModel", "_view_count": null, "_view_module": "@jupyter-widgets\/output", "_view_module_version": "1.0.0", "_view_name": "OutputView", "layout": "IPY_MODEL_a8365279fe104d32b7df01471892a48d", "msg_id": "", "outputs": [{"data": {"text\/html": "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">solver progress (field decay = 1.65e-04) <span style=\"color: #729c1f; text-decoration-color: #729c1f\">\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501<\/span> <span style=\"color: #800080; text-decoration-color: #800080\">100%<\/span> <span style=\"color: #008080; text-decoration-color: #008080\">0:00:00<\/span>\n<\/pre>\n", "text\/plain": "solver progress (field decay = 1.65e-04) \u001b[38;2;114;156;31m\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u001b[0m \u001b[35m100%\u001b[0m \u001b[36m0:00:00\u001b[0m\n"}, "metadata": {}, "output_type": "display_data"}], "tabbable": null, "tooltip": null}}, "6d5ddd60636f49ba8314a133ada8dfdd": {"model_module": "@jupyter-widgets\/output", "model_module_version": "1.0.0", "model_name": "OutputModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets\/output", "_model_module_version": "1.0.0", "_model_name": "OutputModel", "_view_count": null, "_view_module": "@jupyter-widgets\/output", "_view_module_version": "1.0.0", "_view_name": "OutputView", "layout": "IPY_MODEL_f70cb7b91c374031b9311e10a492d617", "msg_id": "", "outputs": [{"data": {"text\/html": "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #008000; text-decoration-color: #008000\">\ud83c\udfc3 <\/span> <span style=\"color: #008000; text-decoration-color: #008000; font-weight: bold\">Starting 'GratingEfficiency'...<\/span>\n<\/pre>\n", "text\/plain": "\u001b[32m\ud83c\udfc3 \u001b[0m \u001b[1;32mStarting 'GratingEfficiency'...\u001b[0m\n"}, "metadata": {}, "output_type": "display_data"}], "tabbable": null, "tooltip": null}}, "71759149ba764703910192c0eada2d90": {"model_module": "@jupyter-widgets\/output", "model_module_version": "1.0.0", "model_name": "OutputModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets\/output", "_model_module_version": "1.0.0", "_model_name": "OutputModel", "_view_count": null, "_view_module": "@jupyter-widgets\/output", "_view_module_version": "1.0.0", "_view_name": "OutputView", "layout": "IPY_MODEL_f44e9ff40d4e42988944398dcba8f128", "msg_id": "", "outputs": [{"data": {"text\/html": "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">solver progress (field decay = 1.16e-05) <span style=\"color: #729c1f; text-decoration-color: #729c1f\">\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501<\/span> <span style=\"color: #800080; text-decoration-color: #800080\">100%<\/span> <span style=\"color: #008080; text-decoration-color: #008080\">0:00:00<\/span>\n<\/pre>\n", "text\/plain": "solver progress (field decay = 1.16e-05) \u001b[38;2;114;156;31m\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u001b[0m \u001b[35m100%\u001b[0m \u001b[36m0:00:00\u001b[0m\n"}, "metadata": {}, "output_type": "display_data"}], "tabbable": null, "tooltip": null}}, "9071aba6fac64cbca18a5b3eedd473cf": {"model_module": "@jupyter-widgets\/base", "model_module_version": "2.0.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets\/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets\/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "9922f87f2f304736b316baeaf6e1863d": {"model_module": "@jupyter-widgets\/output", "model_module_version": "1.0.0", "model_name": "OutputModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets\/output", "_model_module_version": "1.0.0", "_model_name": "OutputModel", "_view_count": null, "_view_module": "@jupyter-widgets\/output", "_view_module_version": "1.0.0", "_view_name": "OutputView", "layout": "IPY_MODEL_05f41b6c428141eaaf02ecd9db8454e4", "msg_id": "", "outputs": [{"data": {"text\/html": "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #008000; text-decoration-color: #008000\">\ud83c\udfc3 <\/span> <span style=\"color: #008000; text-decoration-color: #008000; font-weight: bold\">Finishing 'GratingEfficiency'...<\/span>\n<\/pre>\n", "text\/plain": "\u001b[32m\ud83c\udfc3 \u001b[0m \u001b[1;32mFinishing 'GratingEfficiency'...\u001b[0m\n"}, "metadata": {}, "output_type": "display_data"}], "tabbable": null, "tooltip": null}}, "a8365279fe104d32b7df01471892a48d": {"model_module": "@jupyter-widgets\/base", "model_module_version": "2.0.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets\/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets\/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "b8af708186714bebbb32882c4e8b80cd": {"model_module": "@jupyter-widgets\/output", "model_module_version": "1.0.0", "model_name": "OutputModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets\/output", "_model_module_version": "1.0.0", "_model_name": "OutputModel", "_view_count": null, "_view_module": "@jupyter-widgets\/output", "_view_module_version": "1.0.0", "_view_name": "OutputView", "layout": "IPY_MODEL_0ff704b8b1c3489e8c3a441da21c284d", "msg_id": "", "outputs": [{"data": {"text\/html": "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #008000; text-decoration-color: #008000; font-weight: bold\">\u2193<\/span> <span style=\"color: #000080; text-decoration-color: #000080; font-weight: bold\">monitor_data.hdf5<\/span> <span style=\"color: #729c1f; text-decoration-color: #729c1f\">\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501<\/span> <span style=\"color: #800080; text-decoration-color: #800080\">100.0%<\/span> \u2022 <span style=\"color: #008000; text-decoration-color: #008000\">16.2\/16.2 MB<\/span> \u2022 <span style=\"color: #800000; text-decoration-color: #800000\">16.8 MB\/s<\/span> \u2022 <span style=\"color: #008080; text-decoration-color: #008080\">0:00:00<\/span>\n<\/pre>\n", "text\/plain": "\u001b[1;32m\u2193\u001b[0m \u001b[1;34mmonitor_data.hdf5\u001b[0m \u001b[38;2;114;156;31m\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u001b[0m \u001b[35m100.0%\u001b[0m \u2022 \u001b[32m16.2\/16.2 MB\u001b[0m \u2022 \u001b[31m16.8 MB\/s\u001b[0m \u2022 \u001b[36m0:00:00\u001b[0m\n"}, "metadata": {}, "output_type": "display_data"}], "tabbable": null, "tooltip": null}}, "b9ab73cf473e4b7493678a00eccdd925": {"model_module": "@jupyter-widgets\/base", "model_module_version": "2.0.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets\/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets\/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "cc9929525eb2455b94455d187add47fe": {"model_module": "@jupyter-widgets\/base", "model_module_version": "2.0.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets\/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets\/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "cf6f543ba2da4607907a28cb77a44378": {"model_module": "@jupyter-widgets\/base", "model_module_version": "2.0.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets\/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets\/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "e44548ee41b547579a2ba0b517732be5": {"model_module": "@jupyter-widgets\/output", "model_module_version": "1.0.0", "model_name": "OutputModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets\/output", "_model_module_version": "1.0.0", "_model_name": "OutputModel", "_view_count": null, "_view_module": "@jupyter-widgets\/output", "_view_module_version": "1.0.0", "_view_name": "OutputView", "layout": "IPY_MODEL_9071aba6fac64cbca18a5b3eedd473cf", "msg_id": "", "outputs": [{"data": {"text\/html": "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #008000; text-decoration-color: #008000\">\ud83c\udfc3 <\/span> <span style=\"color: #008000; text-decoration-color: #008000; font-weight: bold\">Starting 'GratingEfficiency'...<\/span>\n<\/pre>\n", "text\/plain": "\u001b[32m\ud83c\udfc3 \u001b[0m \u001b[1;32mStarting 'GratingEfficiency'...\u001b[0m\n"}, "metadata": {}, "output_type": "display_data"}], "tabbable": null, "tooltip": null}}, "f44e9ff40d4e42988944398dcba8f128": {"model_module": "@jupyter-widgets\/base", "model_module_version": "2.0.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets\/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets\/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "f70cb7b91c374031b9311e10a492d617": {"model_module": "@jupyter-widgets\/base", "model_module_version": "2.0.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets\/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets\/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "fc8cf21464424c9f97253af834343e4d": {"model_module": "@jupyter-widgets\/output", "model_module_version": "1.0.0", "model_name": "OutputModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets\/output", "_model_module_version": "1.0.0", "_model_name": "OutputModel", "_view_count": null, "_view_module": "@jupyter-widgets\/output", "_view_module_version": "1.0.0", "_view_name": "OutputView", "layout": "IPY_MODEL_cc9929525eb2455b94455d187add47fe", "msg_id": "", "outputs": [{"data": {"text\/html": "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #800000; text-decoration-color: #800000; font-weight: bold\">\u2191<\/span> <span style=\"color: #000080; text-decoration-color: #000080; font-weight: bold\">simulation.hdf5.gz<\/span> <span style=\"color: #729c1f; text-decoration-color: #729c1f\">\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501<\/span> <span style=\"color: #800080; text-decoration-color: #800080\">100.0%<\/span> \u2022 <span style=\"color: #008000; text-decoration-color: #008000\">1.5\/1.5 kB<\/span> \u2022 <span style=\"color: #800000; text-decoration-color: #800000\">?<\/span> \u2022 <span style=\"color: #008080; text-decoration-color: #008080\">0:00:00<\/span>\n<\/pre>\n", "text\/plain": "\u001b[1;31m\u2191\u001b[0m \u001b[1;34msimulation.hdf5.gz\u001b[0m \u001b[38;2;114;156;31m\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u001b[0m \u001b[35m100.0%\u001b[0m \u2022 \u001b[32m1.5\/1.5 kB\u001b[0m \u2022 \u001b[31m?\u001b[0m \u2022 \u001b[36m0:00:00\u001b[0m\n"}, "metadata": {}, "output_type": "display_data"}], "tabbable": null, "tooltip": null}}}, "version_major": 2, "version_minor": 0}
</script>
</html>
