class SearchEngine{appId="7HAKFDYBT6";apiKey="ad5a07592a5eaa0acc93e2490383eb53";indexName="all_categories";hitsContainerId="hits-container";categories=["All","Tutorials","FAQ","Applications","Lectures","Docs","Blog","Website"];search=null;suggestions=null;product="tidy3d";category="All";suggestionIndexName="faq-titles";initialRouteState={query:"",page:1};_all="all";query="";count=0;inputted=!1;focusIndex=-1;suggestionsDom=null;categoryDom=null;hitsDom=null;initial=!0;categoryMap={tutorials:"Tutorial",faq:"FAQ",applications:"Application",lectures:"Lecture",docs:"Doc",blog:"Blog",website:"Website"};constructor(){this.categoryDom=this.getCategoryDom(),this.hitsDom=this.getHitsDom()}getCategoryDom=()=>{const e=document.querySelector(".search-engine-tabs");if(!e)return;const t=e.querySelector(".body");return t?.querySelector(`div[data-tab-name="${this.product}"]`)};getHitsDom=()=>document.getElementById("hits");setFacetRefinement=e=>{if(e)switch(e.toLowerCase()){case"tutorials":return[this.categoryMap.tutorials];case"faq":return[this.categoryMap.faq];case"applications":return[this.categoryMap.applications];case"lectures":return[this.categoryMap.lectures];case"docs":return[this.categoryMap.docs];case"blog":return[this.categoryMap.blog];case"website":return[this.categoryMap.website];default:return[this.categoryMap.tutorials,this.categoryMap.faq,this.categoryMap.applications,this.categoryMap.lectures,this.categoryMap.docs,this.categoryMap.blog,this.categoryMap.website]}};isElementInViewport=(e,t=window.document)=>{const s=t[0].getBoundingClientRect(),i=e[0].getBoundingClientRect(),n=(i.left+i.right)/2,o=(i.top+i.bottom)/2;return n>=s.left&&n<=s.right&&o>=s.top&&o<=s.bottom};moveDownResult=()=>{if(this.initial)return;const e=this.suggestionsDom.parent(),t=$(this.suggestionsDom).height();e.css("margin-bottom",`${t}px`)};resetResult=()=>{this.suggestionsDom.parent().css("margin-bottom","0")};closeSelectDropdown=()=>{this.suggestionsDom.hide(),this.focusIndex=-1,this.resetResult()};openSelectDropdown=()=>{this.suggestionsDom.show(),this.moveDownResult()};scrollIfNeeded=e=>{if(!e)return;const t=this.suggestionsDom.height(),s=e.outerHeight(),i=e.position().top,n=i+s,o=this.suggestionsDom.scrollTop();i<0?this.suggestionsDom.scrollTop(o+i-16):n>t&&this.suggestionsDom.scrollTop(o+n-t)};blurSuggestion=e=>{$(e)?.removeClass("focus")};focusSuggestion=(e,t=!0)=>{if(!this.suggestionsDom||this.suggestionsDom.is(":hidden"))return;const s=$(this.suggestionsDom).children(),i=s.length,n=this.focusIndex;if(this.focusIndex=e<=0?e:e>=i?i-1:e,this.focusIndex!==n){const e=s.eq(n);this.blurSuggestion(e)}const o=s.eq(this.focusIndex);o.addClass("focus"),t&&this.scrollIfNeeded(o)};getCategoryLink=(e,t,s)=>{if(t===this.categoryMap.docs)return{href:"https://docs.flexcompute.com/projects/tidy3d/en/latest/",target:"_blank"};if(!e.length)return{href:s};const i=(t,s)=>{t&&!t.startsWith("https://")&&(t="https://www.flexcompute.com"+t);const n=new URL(t);return n.search.length>0||n.hash.length>0?(s+=1,i(e[e.length-s].url,s)):t};return{href:i(e[e.length-1].url,1)}};searchEngineSetUp=()=>{const{algoliasearch:e,instantsearch:t}=window;if(!e||!t)return;const s=e(this.appId,this.apiKey);this.search=t({indexName:this.indexName,searchClient:s,stalledSearchDelay:200,showLoadingIndicator:!0,initialUiState:{[this.indexName]:this.initialRouteState},searchFunction:e=>{this.categoryDom||(this.categoryDom=this.getCategoryDom()),this.hitsDom||(this.hitsDom=this.getHitsDom()),this.initial?(this.initial=0===this.query.length,this.hiddenCategoryDom(this.categoryDom,"20px"),this.hiddenCategoryDom(this.hitsDom,!1)):(e.search(),this.visibleCategoryDom(this.categoryDom),this.visibleCategoryDom(this.hitsDom),this.searchPanelPositionStart(),this.searchPanelAutoHeight())},routing:{stateMapping:{stateToRoute:e=>{const t=e[this.indexName];return{q:this.query||"",category:this.category,product:this.product,page:t.page}},routeToState:e=>{this.query=this.query||e.q||"",this.category=this.category||e.category||"All";const t=this.setFacetRefinement(this.category);return{[this.indexName]:{query:this.query,page:e.page,refinementList:{category:t}}}}}},future:{preserveSharedStateOnUnmount:!0}}),this.suggestions=t({indexName:this.suggestionIndexName,searchClient:s,insights:!0});const i=t.connectors.connectSearchBox(((e,t)=>{const{query:s,refine:i,clear:n,isSearchStalled:o,widgetParams:a}=e;if(t){const e=a.container,t=e.querySelector("#__pg_search_search-box_input"),s=$(e).find(".jam-close-circle-f");t.focus(),t.addEventListener("input",(e=>{this.inputted||(this.inputted=!0),this.focusIndex=-1,this.suggestionsDom.scrollTop(0),this.query=e.target.value,this.initial=this.initial&&0===this.query.length,this.handleQuery(),this.handleSuggestionQuery(),this.toggleCloseIcon(s)})),$(t).on("click",(t=>{t.originalEvent.isTrusted&&(this.searchPanelPositionStart(),this.initial&&0===this.query.length&&this.searchPanelFixedHeight(),this.suggestionsDom.is(":hidden")&&(this.handleSuggestionQuery(),e.classList.add("box-shadow"),this.openSelectDropdown()),this.toggleCloseIcon(s))})),$(t).keydown((e=>{this.suggestionsDom&&!this.suggestionsDom.is(":hidden")&&("ArrowUp"===e.key?(this.focusSuggestion(this.focusIndex-1),e.preventDefault()):"ArrowDown"===e.key||"Tab"===e.key?(this.focusSuggestion(this.focusIndex+1),e.preventDefault()):"Enter"!==e.key&&"Return"!==e.key||(this.suggestionsDom.parent().removeClass("box-shadow"),this.focusIndex>=0&&this.focusIndex<this.suggestionsDom.children().length&&(this.query=this.suggestionsDom.children().eq(this.focusIndex).text(),this.handleSuggestionQuery(),this.handleQuery(),e.preventDefault()),$(t).blur(),this.closeSelectDropdown()))})),this.suggestionsDom=$(e).find(".select-items"),$(t).blur((e=>{this.inputted=!1,this.initial&&0===this.query.length&&this.searchPanelPositionCenter()})),$(document).on("mousedown",(t=>{$(t.target).closest(e).length||this.suggestionsDom.is(":hidden")||(e.classList.remove("box-shadow"),this.closeSelectDropdown())})),$(t).change((e=>{this.toggleCloseIcon(s)})),$(s).click((e=>{this.query="",$(t).val(""),this.handleQuery(),this.handleSuggestionQuery(),this.toggleCloseIcon(s)}))}a.container.querySelector("input").value=s})),n=t.connectors.connectHits(((e,s)=>{const{hits:i,widgetParams:n}=e;n.container.innerHTML=i.length>0?`\n       <div class="row row-gap-24">\n       ${i.map((e=>{let s=t.highlight({attribute:"name",hit:e});s||(s=t.highlight({attribute:"title",hit:e}));const i=t.snippet({attribute:"content",hit:e}),n=e.url;let o="_self";n.includes("www.flexcompute.com")||(o="_blank");const a=e.breadcrumbs??[],{href:r,target:c="_self"}=this.getCategoryLink(a,e.category,n);return`\n          <div class="col-12 col-lg-6">\n            <div class="d-flex justify-content-between">\n              <h3 class="font-size-18 line-height-22 font-weight-500 color-dark-3 pr-16 mb-8 d-flex align-items-start column-gap-8" style="flex: 1">\n                <span class="line-height-20">&bull;</span>\n                <a class="color-dark-3 color-primary-hover higher-display-ellipsis ellipsis-line-2" href="${n}" target="${o}">\n                ${s}\n                </a>\n              </h3>\n              <a href="${r}" target="${c}" class="d-inline-block color-primary-hover category-box">${e.category}</a>\n            </div>\n            <p class="line-height-22 font-size-14 pl-16 pr-16 color-dark-gray higher-display-ellipsis ellipsis-line-3 mb-0" style="word-break: break-all">${i}</p>\n          </div>\n       `})).join("")}\n      </div>\n      `:"There are no results for this query."})),o=t.connectors.connectPagination(((e,t)=>{const{currentRefinement:s,nbPages:i,nbHits:n,isFirstPage:o,isLastPage:a,refine:r,createURL:c,widgetParams:l}=e,h=l.container;let u=n;"all"===this.category.toLowerCase()&&(u=this.count||n),h.innerHTML=n>0?`\n        <div class="d-flex justify-content-end align-items-center column-gap-8">\n          <span style="color:#7A7977">${u} results</span>\n          <div class="search-pagination">\n            <a \n              class="${o?"disabled":""}" \n              href="${c(s-1)}"\n              data-value="${s-1}">\n              <i class="jam jam-arrow-left color-dark-gray"></i></a>\n            <a \n              class="${a?"disabled":""}" \n              href="${c(s+1)}"\n              data-value="${s+1}">\n              <i class="jam jam-arrow-right color-dark-gray"></i></a>\n          </div>\n          <span style="color: #7A7977">\n            ${s+1} - ${i}\n          </span>\n        </div>\n      `:"",[...h.querySelectorAll("a")].forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault();const t=e.currentTarget.dataset.value;t>=0&&t<i&&r(t)}))}))})),a=t.connectors.connectRefinementList(((e,t)=>{if(!t){const t=document.querySelector(`div.tab-body[data-tab-name=${this.product.toLowerCase()}]`);if(!t)return null;this.categories.forEach((s=>{let i=0;const n=this.setFacetRefinement(s),o=t.querySelector(`span.custom-radio[data-tag-value=${s}]`);if(1===n.length&&"all"!==s.toLowerCase()){const{count:t=0}=e.items.find((e=>e.value===n[0]))??{};i=t}7===n.length&&"all"===s.toLowerCase()&&(i=e.items.reduce(((e,t)=>(n.includes(t.value)&&(e+=t.count),e)),0)),i>999&&(i="999+"),o&&(o.setAttribute("data-result-count",`${i}`),o.innerHTML=`${s} (${i})`)}))}return null})),r=t.connectors.connectRefinementList((()=>null)),c=t.connectors.connectAutocomplete((({indices:e,refine:t,widgetParams:s},i)=>{const{container:n,onSelectChange:o}=s,a=n.parent();if(i){const e=this;a.append('<div class="select-items" style="display: none"></div>');const t=a.find(".select-items");return t.on("click","div",(function(){o($(this).text()),a.removeClass("box-shadow"),e.closeSelectDropdown()})),void $(t).on({mouseenter:function(){if(e.isElementInViewport($(this),t)){const s=$(t).children().eq(e.focusIndex);e.blurSuggestion(s),e.focusIndex=Number($(this).attr("data-option-index")),e.focusSuggestion(e.focusIndex,!1)}},mouseleave:function(){}},".item")}const r=a.find(".select-items");r.empty();let c=!1;e.forEach((e=>{e.results.hits.forEach(((e,t)=>{c=!0,r.append(`<div class="item color-dark-3" data-option-index="${t}" data-select-value="${e.query}">${e.query}</div>`)}))})),c?this.inputted&&c&&this.openSelectDropdown():this.closeSelectDropdown()}));this.search.addWidgets([i({container:document.querySelector("#search-box")}),n({container:document.querySelector(`#${this.hitsContainerId}`)}),a({attribute:"category",operator:"or"}),o({container:document.querySelector(`#${this.hitsContainerId}-pagination`)})]),this.suggestions.addWidgets([r({attribute:"category"}),c({container:$("#__pg_search_search-box_input"),onSelectChange:e=>{this.query=e,this.initial=this.initial&&0===this.query.length,this.handleSuggestionQuery(),this.handleQuery()}})]),this.suggestions.start(),this.search.start(),this.initialRoute()};toggleCloseIcon=e=>{e&&(this.query.length||e.is(":hidden")?this.query.length>0&&e.is(":hidden")&&e.show():e.hide())};hideElement=e=>{e.classList.contains("d-block")&&(e.classList.remove("d-block"),e.classList.add("d-none"))};displayElement=e=>{e.classList.contains("d-none")&&(e.classList.add("d-block"),e.classList.remove("d-none"))};setSelected=e=>{e.classList.contains("selected")||e.classList.add("selected")};removeSelected=e=>{e.classList.contains("selected")&&e.classList.remove("selected")};resetChildrenElements=e=>{if(e)for(let t=0;t<e.childNodes.length;t++){const s=e.childNodes[t];s.nodeType===Node.ELEMENT_NODE&&this.removeSelected(s)}};onCategoryChange=e=>{const t=e.target,s=this.category,i=t.getAttribute("data-tag-value");if(!i)return;this.category=i,this.setFilterUiState(s);const n=e.currentTarget;t&&n&&i&&this.selectCategoryTag(t,n,i)};selectCategoryTag=(e,t,s)=>{this.resetChildrenElements(t),this.setSelected(e),this.changeCategoryVisible(s)};onProductChange=e=>{const t=e.currentTarget,s=this.category,i=t.getAttribute("data-tab-name");if(!i)return;this.product=i,this.setFilterUiState(s);const n=t.parentElement;t&&n&&i&&this.selectProductTab(t,n,i)};selectProductTab=(e,t,s)=>{this.resetChildrenElements(t),this.setSelected(e);const i=t.nextElementSibling;this.resetChildrenElements(i);const n=i.querySelector(`div[data-tab-name='${s}']`);this.setSelected(n),this.changeHitsVisible(s)};changeHitsVisible=e=>{const t=document.querySelector("#hits");if(!t)return;const s=t.querySelector(`div[data-product-name="${e}"]`);if(!s||s.classList.contains("d-black"))return;const i=t.childNodes;for(let e=0;e<i.length;e++){const t=i[e];t.nodeType===Node.ELEMENT_NODE&&t.classList.contains("d-block")&&this.hideElement(t)}this.displayElement(s)};changeCategoryVisible=e=>{const t=document.querySelector("#hits");if(!t)return;const s=t.querySelector(`div[data-product-name="${this.product}"]`);if(!s)return;const i=s.childNodes;if("All"===e)for(let e=0;e<i.length;e++){const t=i[e];t.nodeType===Node.ELEMENT_NODE&&t.classList.contains("d-none")&&this.displayElement(t)}else{const t=e.toLowerCase().split(" ").join("-"),n=s.querySelector(`div[data-category-name="${this.product.toLowerCase()}-${t}"]`);for(let e=0;e<i.length;e++){const t=i[e];t.nodeType===Node.ELEMENT_NODE&&t.classList.contains("d-block")&&this.hideElement(t)}this.displayElement(n)}};getURLOptions=()=>{const e=location.search.substring(1).split("&");if(!e.length||!e[0])return;const t={};return e.forEach((e=>{const[s,i]=e.split("=");t[s]=decodeURIComponent(i)})),t};initialRoute=()=>{const e=this.getURLOptions();if(this.query||!window.location.search){if(!e&&this.query){const e=new URL(window.location.href);e.searchParams.set("q",""),e.searchParams.set("product",this.product),e.searchParams.set("category",this.category),window.history.replaceState({},"",e.href)}else if(e){const t=document.querySelector(".search-engine-tabs");if(!t)return;this.product=e.product;const s=t.querySelector(".headers"),i=s.querySelector(`div[data-tab-name="${this.product}"]`);this.selectProductTab(i,s,this.product),this.category=e.category;const n=t.querySelector(".body").querySelector(`div[data-tab-name="${this.product}"]`).querySelector("div.category-selector"),o=n.querySelector(`span[data-tag-value="${this.category}"]`);o.click(),this.selectCategoryTag(o,n,this.category)}}else window.history.replaceState({},"",window.location.href.split(window.location.search).join(""))};handleQuery=()=>{const e=this.setFacetRefinement(this.category);this.search.helper.setQuery(this.query).removeDisjunctiveFacetRefinement("category"),e&&e.forEach((e=>{this.search.helper.addDisjunctiveFacetRefinement("category",[e])})),this.search.helper.search()};handleSuggestionQuery=()=>{const e=this.setFacetRefinement(this.category);this.suggestions.helper.setQuery(this.query).removeDisjunctiveFacetRefinement("category"),e&&e.forEach((e=>{this.suggestions.helper.addDisjunctiveFacetRefinement("category",[e])})),this.suggestions.helper.search()};setFilterUiState=e=>{this.handleQuery(),this.handleSuggestionQuery()};hiddenCategoryDom=(e,t="0px")=>{e&&($(e).css("visibility","hidden"),t&&$(e).css("height",t))};visibleCategoryDom=e=>{e&&($(e).css("visibility","visible"),$(e).css("height","auto"))};searchPanelPositionStart=()=>{const e=document.querySelector(".search-panel");e&&!e.classList.contains("search-panel-position-start")&&(e.classList.remove("search-panel-position-center"),e.classList.add("search-panel-position-start"))};searchPanelFixedHeight=()=>{const e=document.querySelector(".search-panel");e&&!e.classList.contains("fixed-height")&&(e.classList.remove("auto-height"),e.classList.add("fixed-height"))};searchPanelPositionCenter=()=>{const e=document.querySelector(".search-panel");e&&!e.classList.contains("search-panel-position-center")&&(e.classList.remove("search-panel-position-start"),e.classList.add("search-panel-position-center"))};searchPanelAutoHeight=()=>{const e=document.querySelector(".search-panel");e&&!e.classList.contains("auto-height")&&(e.classList.remove("fixed-height"),e.classList.add("auto-height"))}}const $searchEngine=new SearchEngine;document.addEventListener("DOMContentLoaded",(e=>{$searchEngine.searchEngineSetUp()}));
